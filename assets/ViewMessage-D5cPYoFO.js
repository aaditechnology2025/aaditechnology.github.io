import{U as z,V as Y,j as e,P as n,h as O,r as g,S as ee,A as te,q as H,v as $,C as se,n as re,B,E as y,I as M,F as P,bl as h,T as ae,u as oe,z as le,c as G,dO as ne,dP as ie,dQ as V,m as ce}from"./index-CpZD2H93.js";import{d as de}from"./Reply-C_nMmpFx.js";import{n as he,L as ge,B as x,f as R,C as A}from"./CardStyle-CBuNm0_N.js";import{Q as ue}from"./QuestionMark-B_7MKkiz.js";import{E as me}from"./EditTwoTone-7ouzJGDn.js";import"./Card-B0aZ7mGs.js";var N={},pe=Y;Object.defineProperty(N,"__esModule",{value:!0});var Q=N.default=void 0,xe=pe(z()),Re=e,fe=(0,xe.default)((0,Re.jsx)("path",{d:"M12 8V4l8 8-8 8v-4H4V8z"}),"Forward");Q=N.default=fe;var L={},Ie=Y;Object.defineProperty(L,"__esModule",{value:!0});var W=L.default=void 0,je=Ie(z()),Ce=e,ve=(0,je.default)((0,Ce.jsx)("path",{d:"M7 8V5l-7 7 7 7v-3l-4-4 4-4zm6 1V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11z"}),"ReplyAll");W=L.default=ve;J.propTypes={From:n.string,To:n.string,Cc:n.string,Text:n.string,ViewDetail:n.object,Body:n.string,Attachments:n.any,ID:n.string,Viewsent:n.array,LoggedInUserNameForMessage:n.string};function J({ViewDetail:a,From:f,To:o,Cc:c,Body:t,Text:I,Attachments:D,ID:T,Viewsent:q,ViewSentObject:l,LoggedInUserNameForMessage:u="",MessageCenterReadMode:j,InsertDateInFormat:b}){O();let U=D,d=[],_=localStorage.getItem("SiteURL")+"/RITeSchool/Uploads/";sessionStorage.getItem("Id"),sessionStorage.getItem("RoleId");const[C,w]=g.useState([]);if(Object.keys(D).length==0)C.push("null");else for(const s in U){let m={FileName:`${s}`,FilePath:_+`${s}`};C.push(s),d.push(m)}ee(),t.replace(/(\r\n|\r|\n)/g,"<br>");const v=l.SenderUserId,r=v+","+l.ReceiverUserId,i=l.ReceiverUserIdCc,K=te(),X=f+","+o,k=s=>{const m=s==="Reply"?`/${location.pathname.split("/")[1]}/MessageCenter/Compose/Reply`:s==="Edit"?`/${location.pathname.split("/")[1]}/MessageCenter/Compose/Edit`:s==="Forward"?`/${location.pathname.split("/")[1]}/MessageCenter/Compose/Forward`:s==="ReplyAll"?`/${location.pathname.split("/")[1]}/MessageCenter/Compose/ReplyAll`:"";K(m),localStorage.setItem("messageBody",t);const E=()=>{let p=X.split(",");return l.LoggedInUserNameForMessage!==null&&(p=p.filter(function(F){return F.replaceAll(" ","")!==(l==null?void 0:l.LoggedInUserNameForMessage.replaceAll(" ",""))})),p.join(",")};localStorage.setItem("ViewMessageData",JSON.stringify({From:s==="Reply"?f:s==="ReplyAll"?E():s==="Edit"?o:"",FromUserID:s==="Reply"?v:s==="ReplyAll"?r:s==="Edit"?l.ReceiverUserId:"",Text:I,Attachment:s==="Edit"?[]:C,ID:T,CC:s==="ReplyAll"||s==="Edit"?c:"",CCReceiverUserId:s==="ReplyAll"||s==="Edit"?i:""}))};let{FromRoute:S}=H();S=$(S);function Z(s){const m=/<td(?:\s+style="([^"]*)")?([^>]*)>/g;return s.replace(m,(E,p,F)=>p?p.includes("border:")?E:`<td style="${p};border:1px solid black"${F}>`:`<td style="border:1px solid black"${F}>`)}return e.jsxs(e.Fragment,{children:[e.jsx(se,{navLinks:[{title:"Message Center",path:"/RITeSchool/MessageCenter/msgCenter"},{title:"View Message",path:"/RITeSchool/MessageCenter/viewMSg "}],rightActions:e.jsx(e.Fragment,{children:e.jsx(re,{direction:"row",gap:1,alignItems:"right",sx:{flexWrap:{xs:"wrap",sm:"nowrap"},justifyContent:{xs:"flex-start",sm:"flex-start"}},children:j==!0?null:e.jsxs(he,{children:[e.jsx(B,{children:e.jsx(y,{title:'View detailed message received to you. To reply the sender click on "Reply" and to send reply to all the receipients click on "Reply To All".',children:e.jsx(M,{sx:{color:"white",mr:1,backgroundColor:P[500],height:"36px !important",":hover":{backgroundColor:P[600]}},children:e.jsx(ue,{})})})}),S==="Draft"?null:e.jsx(y,{title:"Reply",children:e.jsx(M,{onClick:()=>{k("Reply")},sx:{color:"white",mr:1,backgroundColor:h[500],"&:hover":{backgroundColor:h[600]}},children:e.jsx(de,{})})}),S!=="Draft"&&e.jsx(y,{title:"Reply To All",children:e.jsxs(M,{onClick:()=>{k("ReplyAll")},sx:{color:"white",mr:1,backgroundColor:h[500],"&:hover":{backgroundColor:h[600]}},children:[" ",e.jsx(W,{})]})}),S==="Draft"?e.jsx(y,{title:"Edit",children:e.jsx(M,{onClick:()=>{k("Edit")},sx:{color:"white",mr:1,backgroundColor:h[500],height:"36px !important",":hover":{backgroundColor:h[600]}},children:e.jsx(me,{})})}):e.jsx(y,{title:"Forward",children:e.jsx(M,{onClick:()=>{k("Forward")},sx:{color:"white",backgroundColor:h[500],height:"36px !important",":hover":{backgroundColor:h[600]}},children:e.jsx(Q,{})})})]})})})}),e.jsx(B,{children:e.jsxs(ge,{children:[e.jsxs(x,{children:[e.jsxs(R,{children:[" ",a.From]}),e.jsx(A,{children:f})]}),e.jsx("hr",{}),e.jsxs(x,{children:[e.jsx(R,{children:"Received Date"}),e.jsxs(A,{children:[b," "]})]}),e.jsx("hr",{}),e.jsxs(x,{children:[e.jsxs(R,{children:[" ",a.To]}),e.jsx(A,{children:o})]}),e.jsx("hr",{}),c!==""&&e.jsx(e.Fragment,{children:o===u?null:e.jsxs(x,{children:[e.jsxs(R,{children:[" ",a.Cc]}),e.jsx(A,{children:c})]})}),e.jsxs(x,{children:[e.jsx(R,{children:a.Subject}),e.jsx(A,{children:I})]}),e.jsx("hr",{}),e.jsx(x,{children:d.length>0&&e.jsx(e.Fragment,{children:d.map((s,m)=>e.jsx(R,{onClick:E=>{window.open(s.FilePath)},sx:{color:"#628def"},children:s.FileName.slice(0,40)+"..."},m))})}),e.jsxs(x,{children:[e.jsxs(R,{children:[" ",a.Body]}),e.jsx(ae,{dangerouslySetInnerHTML:{__html:Z(t)}})]})]})})]})}function be({}){const a=oe(),f={From:"From",Subject:"Subject",To:"To",Cc:"Cc",Attachment:"Attachment",Body:"Content"};let{ID:o,FromRoute:c}=H();o=$(o),c=$(c);const[t,I]=g.useState(null),{showAlert:D,closeAlert:T}=g.useContext(le),[q,l]=g.useState(!1),u=sessionStorage.getItem("AcademicYearId"),j=localStorage.getItem("localSchoolId"),b=sessionStorage.getItem("Id");sessionStorage.getItem("RoleId");const U=G(r=>r.getSchoolSettings.EnableMessageCenterReadModeForStudent),d=G(r=>r.DraftMessages.DraftMessage),_={aiSchoolId:j,aiAcademicYearId:u,aiUserId:b,aiDraftId:o},C={asSchoolId:parseInt(j),aiAcademicYearId:parseInt(u),asKey:""},w=()=>{const r={asSchoolId:j,asMessageDetailsId:o,asReceiverId:b,asAcademicYearId:u};ce.post("MessageCenter/GetMessage",r).then(i=>i.data.GetMessagesResult).then(i=>{I(i)})};g.useEffect(()=>{d!=null&&I(d[0])},[d]);const v=localStorage.getItem("localSchoolId");return g.useEffect(()=>{c==="Draft"?a(ne(_)):w()},[]),g.useEffect(()=>{a(ie(C))},[]),g.useEffect(()=>{if(t!=null){if(t.RequestReadReceipt==="True"&&t.ReadingDateTime===null){let r="0";D({title:"Read Receipt Request",message:'The sender of this message has requested "Read Receipt". Do you want to send it?',variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{r="0";const i={asSchoolId:v,asAcademicYearId:u,asReceiverId:t.ReceiverDetailsId,asRequestReadReceipt:r};a(V(i)),T()},onConfirm:()=>{r="1";const i={asSchoolId:v,asAcademicYearId:u,asReceiverId:t.ReceiverDetailsId,asRequestReadReceipt:r};a(V(i)),T()}})}l(!0)}},[t]),e.jsx(B,{sx:{px:2},children:e.jsx(e.Fragment,{children:t===void 0?null:q&&e.jsx(J,{ViewDetail:f,From:c==="Draft"?t.SenderName:t.UserName,InsertDateInFormat:t.InsertDateInFormat,To:t.RecieverName!=null&&t.RecieverName!=""?t.RecieverName:t.DisplayText,Cc:t.DisplayTextCc,Body:t.Body,Text:t.Subject,Attachments:t.Attachments,ID:o,ViewSentObject:t,LoggedInUserNameForMessage:t.LoggedInUserNameForMessage,MessageCenterReadMode:U})})})}export{be as default};
