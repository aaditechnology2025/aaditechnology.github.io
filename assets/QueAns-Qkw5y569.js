import{S as se,r as o,j as e,o as re,B as d,cG as ne,E as ae,cH as ie,G as l,b3 as k,u as le,c as M,fk as oe,fK as ce,t as G,fL as de,fM as xe,fN as R,fO as z,n as ue,T as Q}from"./index-CpZD2H93.js";import{B as me}from"./BackButton-D8aQMrwN.js";import{E as he}from"./Errormessage-DVJGTehf.js";import{P as pe}from"./PageHeader-C9ChZO91.js";import{L as Se}from"./ListSelect-CwnzciXr.js";import{B as T}from"./ButtonStyle-DAEB_dBE.js";import{C as fe}from"./Card-B0aZ7mGs.js";import"./CheckboxImg-BrcA302U.js";import"./RadioButtonUnchecked-r_6mn_G1.js";import"./CardStyle-CBuNm0_N.js";const Ie=()=>{const i=se(),[r,m]=o.useState(!1),[n,f]=o.useState(" "),[I,h]=o.useState(""),w="Support only PDF, DOC, DOCX. File size should not exceed 25 MB",A=p=>{var u;p.preventDefault();let x=p.target.files[0];f(x);let P=new FileReader;P.onload=function(j){alert(j.target.result)};const S=(u=x==null?void 0:x.name)==null?void 0:u.split(".").at(-1),v=["doc","docx","pdf"];if(S===void 0&&h(null),!v.includes(S)&&S!=null?h("Please attach the file in the valid format."):v.includes(S)&&h(null),(x==null?void 0:x.size)>25e5)return h("Please upload a file smaller than 25 MB"),!1},g=()=>{m(p=>!p)},c=()=>{m(!1)};return e.jsxs("div",{children:[e.jsx(re,{fullWidth:!0,id:"fullWidth",type:"file",name:"Attachment",variant:"standard",className:i.InputField,onChange:A,inputProps:{multiple:!1},InputProps:{endAdornment:e.jsx(d,{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",sx:{mb:2},children:e.jsx(ne,{onClickAway:c,children:e.jsx(ae,{PopperProps:{disablePortal:!0},onClose:g,open:r,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,title:w,arrow:!0,placement:"left",componentsProps:{tooltip:{sx:{marginLeft:"70px",mt:.5,transform:"translate3d(17px, 0.5px, 0px) !important"}}},children:e.jsx(ie,{type:"button",onClick:g,sx:{color:"navy",mt:2,fontSize:"17px",float:"right"}})})})})}}),e.jsxs(d,{sx:{mt:"10px"},children:[" ",I?e.jsx(he,{Error:I}):null]})]})},ge=({itemList:i,clickItem:r,selectedItem:m})=>e.jsx("div",{children:e.jsx(l,{container:!0,children:i==null?void 0:i.map((n,f)=>e.jsx(e.Fragment,{children:e.jsx(d,{sx:{ml:"2px"},children:m==n.Name?e.jsx(k,{sx:{bgcolor:m==n.Name?n.IsAnswered?"green":"blue":"",width:29,height:29,fontSize:"10px",mt:"5px"},onClick:()=>{r(n.Name)},children:n.SerialNo}):n.IsAnswered?e.jsx(k,{sx:{bgcolor:n.IsAnswered?"green":"white",border:"3px solid grey",borderRadius:"20px",width:29,height:29,fontSize:"10px",mt:"5px"},onClick:()=>{r(n.Name)},children:n.SerialNo}):e.jsx(k,{sx:{bgcolor:"white",color:"black",border:"3px solid grey",borderRadius:"20px",width:29,height:29,fontSize:"10px",mt:"5px"},onClick:()=>{r(n.Name)},children:n.SerialNo})})}))})}),Ne=()=>{const i=le();o.useRef(null);const[r,m]=o.useState(0),n=localStorage.getItem("localSchoolId"),f=sessionStorage.getItem("AcademicYearId"),I=sessionStorage.getItem("StandardId"),h=sessionStorage.getItem("StandardDivisionId"),w=sessionStorage.getItem("StudentId"),A=localStorage.getItem("Examid"),g=localStorage.getItem("SubjectId"),[c,p]=o.useState([]),[x,P]=o.useState([]),[S,v]=o.useState(!0),u=M(t=>t.OnlineExam.ExamData),j=M(t=>t.OnlineExam.SubmitExam),y=M(t=>t.OnlineExam.SaveExam),C=M(t=>t.OnlineExam.ExamSchedulesList),W=parseInt(C[0].StartTime.split(":")[0])*60*60+parseInt(C[0].StartTime.split(":")[1])*60,Y=parseInt(C[0].EndTime.split(":")[0])*60*60+parseInt(C[0].EndTime.split(":")[1])*60,[b,$]=o.useState(localStorage.getItem("timerState")=="0"?Y-W:Number(localStorage.getItem("timerState"))),H=t=>{const s=Math.floor(t/3600),a=Math.floor(t%3600/60),E=t%60;return`${s}:${a<10?"0":""}${a}:${E<10?"0":""}${E}`},U=c.map(t=>({AddMarks:t.Parent})),X=()=>{let t=0;return c.map(s=>{s.Child.map(a=>{a.IsCorrectAnswer===!0&&a.IsCorrectAnswer===a.isActive&&(t=t+s.Parent.Marks)})}),t},q=U.reduce((t,s)=>t=t+s.AddMarks.Marks,0),K=()=>c.map((t,s)=>({QuestionId:t.Parent.Id,AnswerId:V(t),DescriptionFileName:""})),V=t=>{const s=t.Child.filter(a=>a.isActive);return s.length>0?s[0].Id:""},F={aiSchoolId:n,aiAcademicYearId:f,aiStandardId:I,aiStandardDivisionId:h,aiSubjectId:g,aiExamId:A,aiStudentId:w,aiTotalMarks:X().toString(),aiOutOfMarks:q,aiInsertedById:"",asAttachmentBase64String:"",alstQuestAnswerDetails:K()},_=()=>{i(R(F))},O={aiSchoolId:n,aiAcademicYrId:f,asStandardId:I,asStdDivId:h,asSubjectId:g,asSchoolwiseTestId:A,asStudentId:w},D={aiSchoolId:n,aiAcademicYearId:f,aiStandardId:I,aiStandardDivisionId:h,aiSubjectId:g,aiExamId:A,aiStudentId:w};o.useEffect(()=>{i(oe(O)),i(ce(O))},[]);let B="";o.useEffect(()=>{u!==void 0&&u.map((t,s)=>B=t.Parent.IsExamSubmitted)},[u]),o.useEffect(()=>{j!==null&&j!==""&&(G.success(j,{toastId:"success1"}),i(de()),setTimeout(()=>{window.location.href="/RITeSchool/Student/OnlineExam"},2e3)),y!==null&&y!==""&&(G.success(y,{toastId:"success1"}),i(xe()))},[j,y]),o.useEffect(()=>{u.length>0&&(v(!B),p(u),P(u.map((t,s)=>({Id:t.Parent.Id,Name:s,SerialNo:t.Parent.SerialNo,IsAnswered:!1}))))},[u]);let N=c.length-1;const J=t=>{p(s=>s.map((a,E)=>E==r?{Parent:a.Parent,Child:t}:a)),P(s=>x.map((a,E)=>E==r?{...a,IsAnswered:Z(t)}:a))},Z=t=>{let s=!1;return t.map(a=>{a.isActive&&(s=!0)}),s},L=t=>{if(t==1&&r==N){m(0);return}if(t==-1&&r==0){m(N);return}m(s=>s+t)},ee=t=>{m(t)},te=()=>{window.confirm("Are you sure you want to Submit the exam?")===!0&&i(z(D)),clearInterval(b)};return o.useEffect(()=>{localStorage.setItem("timerState",b.toString());const t=setInterval(()=>{b>0?$(b-1):(clearInterval(t),i(R(F)),i(z(D)))},1e3);return()=>clearInterval(t)},[b]),e.jsxs(e.Fragment,{children:[e.jsx(pe,{heading:"Online Exam",subheading:""}),e.jsxs(d,{sx:{px:2},children:[u.map((t,s)=>t.Parent.IsExamSubmitted==!0&&e.jsx(me,{FromRoute:"/Student/OnlineExam"})),e.jsxs(fe,{sx:{py:1},children:[S&&e.jsx(e.Fragment,{children:C.length>0&&e.jsx(d,{sx:{textAlign:"center"},children:e.jsxs("p",{children:[e.jsx("b",{children:"Exam Time: "})," ",H(b)]})})}),e.jsx(ue,{direction:"row",justifyContent:"center",alignItems:"center",m:1,children:e.jsx(d,{sx:{height:"150px",width:"320px",overflow:"scroll",border:"1px solid grey"},alignItems:"center",children:e.jsx(ge,{itemList:x,selectedItem:r,clickItem:ee})})}),e.jsxs(l,{container:!0,spacing:1,sx:{mt:"-20px"},p:1,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(d,{sx:{px:2},children:e.jsx(T,{fullWidth:!0,onClick:()=>{L(-1)},children:"Previous"})})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(d,{sx:{px:2},children:e.jsx(T,{fullWidth:!0,onClick:()=>{L(1)},children:"Next"})})})]}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs(l,{container:!0,xs:12,flexDirection:"row",sx:{mt:"8px"},children:[e.jsx(l,{xs:10.3}),e.jsx(l,{xs:1.7,children:e.jsxs(k,{sx:{textAlign:"center",border:"1.5px solid grey",backgroundColor:"white",color:"#4b4b4b",width:25,height:25,fontSize:"10px"},children:[c[r].Parent.Marks,"M"," "]})})]}),e.jsxs(l,{container:!0,xs:12,children:[e.jsx(l,{item:!0,xs:1,children:x.map((t,s)=>e.jsxs(e.Fragment,{children:[" ",r==t.Name&&e.jsxs(Q,{pt:1,pl:1.8,children:[" ",t.SerialNo," "]},s)]}))}),e.jsxs(l,{item:!0,xs:11,children:[e.jsxs(Q,{p:1,children:[" ",c[r].Parent.Name]}),c[r].Parent.path&&e.jsx(d,{ml:3,children:e.jsx(k,{alt:"user.name",src:localStorage.getItem("SiteURL")+"RITeSchool/Uploads/OnlineExamImages/"+c[r].Parent.path,sx:{width:"180px",height:"160px",border:"2px solid gray",textAlign:"center"},variant:"square","aria-label":"add"})})]})]}),e.jsx(Se,{Itemlist:c[r].Child,onChange:J,isSingleSelect:c[r].Parent.isSingleSelect})]}),r==N&&e.jsx(d,{sx:{mt:"-30px",mr:"11px",ml:"25px"},children:e.jsx(Ie,{})}),S&&e.jsx(e.Fragment,{children:e.jsx(l,{container:!0,spacing:1,sx:{mt:"-20px"},p:1,children:e.jsxs(e.Fragment,{children:[e.jsx(l,{container:!0,spacing:1,sx:{mt:"-13px"},p:1}),e.jsx(l,{item:!0,xs:6,children:e.jsx(d,{sx:{px:2},children:e.jsx(T,{fullWidth:!0,onClick:_,children:"Save"})})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(d,{sx:{px:2},children:r==N&&e.jsx(T,{fullWidth:!0,onClick:te,children:"Submit"})})})]})})})]})]})]})};export{Ne as default};
