import{j as e,B as c,G as i,E as N,a6 as V,n as B,T as M,o as oe,aH as G,ag as ke,ah as Ie,ai as te,aj as A,ak as ve,I as T,ap as ne,aq as Pe,bH as b,u as Ee,r as o,c as P,aD as Ge,t as Ne,oQ as we,oK as De,C as Fe,F as le,J as E,K as re,c7 as O,bl as _e,oR as Me}from"./index-CpZD2H93.js";import{d as ae}from"./CloudUpload-C2WsbpCZ.js";import{Q as Ve}from"./QuestionMark-B_7MKkiz.js";const Te=({files:n,commentError:j,comment:f,setFiles:k,setComment:C,setFileList:h,fileList:x,handleFileChange:y,handleAddFile:m})=>{const r="Select Images",l=t=>{const d=x.filter((Y,S)=>S!==t);h(d)};return e.jsxs(c,{pt:2,children:[e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:6,md:4,lg:4,xl:2,children:e.jsx(N,{title:"Supports files of types - .BMP, .JPG, .JPEG, .PNG with total size upto 10 MB.",children:e.jsxs(V,{sx:{width:"auto",height:52,border:t=>`1px dashed ${t.palette.primary.main}`,gap:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between",color:"primary.main"},component:"label",children:[e.jsxs(B,{direction:"row",alignItems:"center",gap:1,sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[n.length>0?e.jsx(ae,{sx:{color:"#38548A"}}):e.jsx(ae,{sx:{color:"#38548A"}}),e.jsx(M,{variant:"body2",noWrap:!0,children:n.length>0?n.map(t=>t.name).join(", "):r})]}),e.jsx("input",{type:"file",multiple:!0,style:{display:"none"},onChange:y})]})})}),e.jsxs(i,{item:!0,xs:12,sm:6,md:4,lg:5,xl:4,children:[e.jsx(oe,{label:"Comment",variant:"outlined",value:f,onChange:t=>C(t.target.value.slice(0,200)),inputProps:{maxLength:200},fullWidth:!0}),e.jsx(G,{Error:j})]})]}),x.length>0&&e.jsxs(ke,{sx:{mt:3,border:1,borderColor:"grey.300"},children:[e.jsx(Ie,{children:e.jsxs(te,{children:[e.jsx(A,{children:e.jsx(M,{color:"primary",children:e.jsx("strong",{children:"File Names"})})}),e.jsx(A,{children:e.jsx(M,{color:"primary",children:e.jsx("strong",{children:"Comment"})})}),e.jsx(A,{children:e.jsx(M,{color:"primary",children:e.jsx("strong",{children:"Delete"})})})]})}),e.jsx(ve,{children:x.map((t,d)=>e.jsxs(te,{children:[e.jsxs(A,{children:["  ",e.jsx(B,{direction:"row",spacing:1,flexWrap:"wrap",children:t.fileNames})]}),e.jsx(A,{children:t.comment}),e.jsx(A,{children:e.jsx(T,{onClick:()=>l(d),sx:{color:"#38548A	","&:hover":{color:"red",backgroundColor:ne[100]}},children:e.jsx(N,{title:"Delete",children:e.jsx(Pe,{})})})})]},d))})]})]})},Be=({ItemList:n,ParentList:j,ClickChild:f})=>{const k=r=>{let l=[];l=n.map(t=>t.Id===r?{...t,IsActive:!t.IsActive}:t),f(l)},C=r=>{j.map(l=>l.Id===r?{...l,IsActive:!l.IsActive}:l),x(r)},h=r=>{let l=[];l=n.map(t=>({...t,IsActive:r})),f(l)},x=r=>{let l=[];l=n.map(t=>t.ParentId==r?{...t,IsActive:!y(r)}:t),f(l)},y=r=>{let l=!0;return n.map(t=>{t.ParentId==r&&!t.IsActive&&(l=!1)}),l},m=()=>{let r=!0;return n.map(l=>{l.IsActive||(r=!1)}),r};return e.jsxs(e.Fragment,{children:[e.jsxs(c,{sx:{backgroundColor:"lightgrey"},children:[e.jsx(b,{checked:m(),onChange:r=>{h(r.target.checked)}}),e.jsx("strong",{children:"Applicable to all staff members and selected Classes "})]}),e.jsx(B,{direction:"row",gap:.7,flexWrap:"wrap",children:j.map((r,l)=>e.jsxs(c,{children:[e.jsxs(c,{sx:{borderBottom:"1px solid grey",fontWeight:"bold"},children:[e.jsx(b,{checked:y(r.Id),onChange:()=>{C(r.Id)}}),r.Name]}),n.filter(t=>t.ParentId==r.Id).map((t,d)=>e.jsxs(c,{children:[e.jsx(b,{checked:t.IsActive,onChange:()=>{k(t.Id)}}),t.Name]},d))]},l))})]})},X=[{Value:"1",Name:"Pre-Primary"},{Value:"2",Name:"Primary"},{Value:"3",Name:"Secondary"}],Ue=()=>{const n=Ee(),[j,f]=o.useState(null),[k,C]=o.useState([]),[h,x]=o.useState(""),[y,m]=o.useState(""),[r,l]=o.useState(""),[t,d]=o.useState(""),[Y,S]=o.useState(""),[w,I]=o.useState([]),[ie,D]=o.useState(!1),[ce,de]=o.useState(!1),[v,F]=o.useState([]),[L,H]=o.useState(""),[he,J]=o.useState(""),[W,R]=o.useState([]),U=Number(localStorage.getItem("localSchoolId")),Q=Number(sessionStorage.getItem("AcademicYearId")),xe=Number(localStorage.getItem("UserId")),K=P(s=>s.Holidays.AllClassesAndDivisionss),ue=P(s=>s.Holidays.AllClassesAndDivisionss1),$=P(s=>s.PhotoGalllary.IManagePhotoGalleryMsg);P(s=>s.Photo.ISGetPhotoDetils),P(s=>s.PhotoGalllary.IStandardDivisionName);const ge={asSchoolId:U,asAcademicYearId:Q,associatedStandard:""};o.useEffect(()=>{n(Ge(ge))},[]);const me={asSchoolId:U,asSortExp:"ORDER by Update_Date desc",asStartIndex:0,asPageSize:20,asAcademicYearId:Q,asGalleryNameFilter:""},z=String((()=>{let s=[];return k.map(a=>{a.IsActive&&s.push(a.Id)}),s.toString()})());o.useEffect(()=>{C(K)},[K]);const pe=s=>{C(s)},je=s=>{x(s)},fe=s=>{const u=["image/bmp","image/jpg","application/jpeg","image/png"];if(s.target.files){const g=Array.from(s.target.files),p=g.filter(_=>{const ee=_.size<=10485760,se=u.includes(_.type);return ee||l("Total file size should be less than 10 MB"),se||l("Please upload a valid file format."),ee&&se});p.length,g.length,F(p)}};console.log(v,"files123");const Z=()=>{if(v.length===0){l("At least one file should be selected.");return}if(!L.trim()){J("Please add a comment.");return}const s={fileNames:v.map(a=>a.name),comment:L};R([...W,s]),F([]),H("")},Ce=()=>{let s=0,a=`<PhotoGallery>
`;return W.forEach(u=>{u.fileNames.forEach(g=>{s++,a+=`  <PhotoGallery Image_Path="${g}" Image_SrNo="${s}" Comment="${u.comment}" />
`})}),a+="</PhotoGallery>",a},q=async()=>{let s=!0;if(m(""),l(""),S(""),d(""),h.trim()||(m("Gallery name should not be blank."),s=!1),v.length===0&&(l("At least one file should be selected."),s=!1),z.trim()||(S("At least one class should be selected."),s=!1),w.length===0&&(d("At least one section should be associated for photo gallery."),s=!1),!s)return;const a={asSchool_Id:U,asOrg_Gallery_Name:"",asGallery_Name:h,asGallery_DetailsXML:Ce(),asInserted_By_id:xe,asAssociatedSection:w.toString(),asClassesIds:z,Gallery_ID:0};n(Me(a)),m(""),l(""),S(""),d("")};o.useEffect(()=>{$!==""&&(Ne.success($),n(we()),n(De(me)))},[h,z,w,$]);const ye=s=>{const{value:a,checked:u}=s.target;I(u?g=>{const p=[...g,a];return p.length===X.length&&D(!0),p}:g=>{const p=g.filter(_=>_!==a);return D(!1),p})},Se=s=>{const{checked:a}=s.target;D(a),I(a?X.map(u=>u.Value):[])},Ae=s=>{const{checked:a}=s.target;de(a)},be=()=>{I([]),F([]),R([]),x(""),H(""),m(""),l(""),S(""),d(""),D(!1),J("")};return e.jsxs(c,{px:2,children:[e.jsx(Fe,{navLinks:[{title:"Photo Video Gallery",path:"/RITeSchool/Teacher/PhotoVideoGalleryBaseScreen"},{title:"Add Photo Gallery",path:""}],rightActions:e.jsxs(e.Fragment,{children:[e.jsx(N,{title:"Create new photo galleries or add photos to existing gallery. You can also view all gallery photos by clicking on Slideshow.",children:e.jsx(T,{sx:{color:"white",backgroundColor:le[500],"&:hover":{backgroundColor:le[600]}},children:e.jsx(Ve,{})})}),j?e.jsx(e.Fragment,{children:e.jsx(N,{title:"Update Photo",children:e.jsx(T,{sx:{color:"white",backgroundColor:E[500],"&:hover":{backgroundColor:E[600]}},children:e.jsx(re,{})})})}):e.jsx(N,{title:"Save",children:e.jsx(T,{sx:{color:"white",backgroundColor:E[500],"&:hover":{backgroundColor:E[600]}},onClick:q,children:e.jsx(re,{})})})]})}),e.jsxs(c,{padding:2,sx:{backgroundColor:"white"},children:[e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(oe,{fullWidth:!0,inputProps:{maxLength:50},label:e.jsxs("span",{children:["Gallery Name ",e.jsx("span",{style:{color:"red"},children:" *"})]}),variant:"outlined",onChange:s=>{je(s.target.value.slice(0,50))},value:h}),e.jsx(c,{children:e.jsx(G,{Error:y})})]}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(O,{onChange:Ae,control:e.jsx(b,{}),label:"Add More Photos"})})]}),e.jsxs(i,{container:!0,spacing:2,mt:2,ml:.5,children:[e.jsxs(i,{xs:12,sm:10,children:[e.jsx(Te,{files:v,comment:L,setFiles:F,setComment:H,commentError:he,setFileList:R,fileList:W,handleFileChange:fe,handleAddFile:Z}),e.jsx(G,{Error:r})]}),e.jsx(i,{xs:12,sm:2,children:ce===!0?e.jsx(V,{onClick:Z,sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,mt:1,color:"#38548A","&:hover":{color:"#38548A",backgroundColor:_e[100]}},children:"Add Photos"}):e.jsx("span",{})})]}),e.jsx(c,{pt:2,children:e.jsxs(c,{children:[e.jsx(Be,{ItemList:k,ParentList:ue,ClickChild:pe}),e.jsx(G,{Error:Y})]})}),e.jsx(c,{sx:{backgroundColor:"lightgrey",pl:1,mt:2},children:e.jsx(O,{sx:{mr:0},control:e.jsx(b,{checked:ie,onChange:Se}),label:"Associated Sections"})}),e.jsx(i,{container:!0,spacing:2,alignItems:"center",children:e.jsxs(i,{item:!0,xs:12,children:[e.jsx(c,{pl:1,children:X.map(s=>e.jsx(O,{control:e.jsx(b,{value:s.Value,checked:w.includes(s.Value),onChange:ye}),label:s.Name},s.Value))}),e.jsx(G,{Error:t})]})}),e.jsx(i,{item:!0,xs:12,md:12,mt:2,children:e.jsxs(B,{direction:"row",gap:2,alignItems:"center",children:[e.jsx(V,{onClick:be,sx:{color:"red",":hover":{backgroundColor:ne[100]}},children:"Cancel"}),e.jsx(V,{onClick:q,sx:{color:"green",":hover":{backgroundColor:E[100]}},children:"Save"})]})})]})]})};export{Ue as default};
