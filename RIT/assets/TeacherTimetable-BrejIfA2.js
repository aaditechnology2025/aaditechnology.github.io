import{s as styled,aj as TableCell,bJ as alpha,F as grey,u as useDispatch,c as useSelector,r as reactExports,gW as GetTeacherTimeTableResult,gX as CDAGetLectureNoWeekday,gY as CDAGetTeacherSubjectMaxLecDetailsForWeekDays,gZ as GetLectureCountsForTeachers,g_ as GetDataForAdditionalClasses,j as jsxRuntimeExports,B as Box,C as CommonPageHeader,E as Tooltip,I as IconButton,H as default_1,T as Typography,n as Stack,bl as blue,af as TableContainer,ag as Table,ah as TableHead,ai as TableRow,ak as TableBody,D as Divider}from"./index-CpZD2H93.js";const HeaderStyledCell=styled(TableCell)(({theme:e})=>({paddingTop:e.spacing(1),paddingBottom:e.spacing(1),backgroundColor:"#19bed4",color:e.palette.common.white,fontWeight:"bold",textAlign:"center",border:"1px solid rgba(224, 224, 224, 1)"})),StyledCell1=styled(TableCell)(({theme:e})=>({paddingTop:e.spacing(1),paddingBottom:e.spacing(1),border:"1px solid rgba(224, 224, 224, 1)"})),FooterStyledCell=styled(TableCell)(({theme:e})=>({paddingTop:e.spacing(1),paddingBottom:e.spacing(1),backgroundColor:alpha(e.palette.primary.main,.4),fontWeight:"bold",textAlign:"center",border:"1px solid rgba(224, 224, 224, 1)"})),StyledCell=styled(TableCell)(({theme:e})=>({paddingTop:e.spacing(1),paddingBottom:e.spacing(1),textAlign:"center",border:"1px solid rgba(224, 224, 224, 1)","&.grey-background":{backgroundColor:grey[200]},"&.bold-text":{fontWeight:"bold"}})),TeacherTimetable=()=>{const dispatch=useDispatch(),TimeTableList=useSelector(e=>e.TMTimetable.ISGetTeacherTimeTableResult),ApplicablesData=useSelector(e=>e.TMTimetable.ISApplicables),ApplicablesToggleData=useSelector(e=>e.WeeklyTimetable.ISGetApplicables),LectureCountsForTeachers=useSelector(e=>e.TMTimetable.ISGetLectureCountsForTeachers);useSelector(e=>e.TMTimetable.ISGetDataForAdditionalClasses);const TimetableDetails=useSelector(e=>e.WeeklyTimetable.ISTimetableDetails),ExtLectCount=useSelector(e=>e.WeeklyTimetable.ISExtLectCount),TeacherTimetableCellValues=useSelector(e=>e.WeeklyTimetable.ISGetLectureNoWeekday),WeekdayIds=useSelector(e=>e.WeeklyTimetable.ISWeekdayId),MondayColumnList=useSelector(e=>e.WeeklyTimetable.ISGetTeacherSubjectMaxLecForMon),TuesdayColumnList=useSelector(e=>e.WeeklyTimetable.ISGetTeacherSubjectMaxLecForTue),WednesdayColumnList=useSelector(e=>e.WeeklyTimetable.ISGetTeacherSubjectMaxLecForWed),ThursdayColumnList=useSelector(e=>e.WeeklyTimetable.ISGetTeacherSubjectMaxLecForThu),FridayColumnList=useSelector(e=>e.WeeklyTimetable.ISGetTeacherSubjectMaxLecForFri),weeklyTestInfo=useSelector(e=>e.WeeklyTimetable.ISWeeklytestInfo),mptInfo=useSelector(e=>e.WeeklyTimetable.ISMPTinfo),AssemblyInfo=useSelector(e=>e.WeeklyTimetable.ISAssemblyInfo),StayBackInfo=useSelector(e=>e.WeeklyTimetable.ISStayBackInfo),[assembly,setAssembly]=reactExports.useState(!1),[mpt,setMPT]=reactExports.useState(!1),[stayback,setStayback]=reactExports.useState(!1),[weeklytest,setWeekly]=reactExports.useState(!1),[trackTeacherTimetable,setTrackTeacherTimetable]=reactExports.useState({}),[MonCount,setMonCount]=reactExports.useState(),[TueCount,setTueCount]=reactExports.useState(),[WedCount,setWedCount]=reactExports.useState(),[ThuCount,setThuCount]=reactExports.useState(),[FriCount,setFriCount]=reactExports.useState();reactExports.useEffect(()=>{const e={asSchoolId:Number(localStorage.getItem("localSchoolId")),asAcademicYearID:Number(sessionStorage.getItem("AcademicYearId")),asTeacher_Id:Number(sessionStorage.getItem("TeacherId"))},s={asSchoolId:Number(localStorage.getItem("SchoolId")),asAcademicYearId:Number(sessionStorage.getItem("AcademicYearId")),asTeacherID:Number(sessionStorage.getItem("TeacherId"))},t={asSchoolId:Number(localStorage.getItem("SchoolId")),asAcademicYearId:Number(sessionStorage.getItem("AcademicYearId")),asTeacherId:Number(sessionStorage.getItem("TeacherId")),asStandardDivId:Number(sessionStorage.getItem("StandardDivisionId"))};dispatch(GetTeacherTimeTableResult(e)),dispatch(CDAGetLectureNoWeekday(s)),dispatch(CDAGetTeacherSubjectMaxLecDetailsForWeekDays(t))},[]);function isMPTLecture(e,s){return mptInfo.find(a=>a.Text1===e&&a.Text2===s)}function isAssemblyLecture(e,s){return AssemblyInfo.find(a=>a.Text1===e&&a.Text2===s)}function isStaybackLecture(e,s){return StayBackInfo.find(a=>a.Text1===e&&a.Text2===s)}function isWeeklyTestLecture(e,s){return weeklyTestInfo.find(a=>a.Text1===e&&a.Text2===s)}reactExports.useEffect(()=>{if(ApplicablesToggleData.length>0&&Object.keys(trackTeacherTimetable).length>0&&TeacherTimetableCellValues.length>0){let e=["Monday","Tuesday","Wednesday","Thursday","Friday"];const s={Monday:setMonCount,Tuesday:setTueCount,Wednesday:setWedCount,Thursday:setThuCount,Friday:setFriCount};e.forEach(t=>{let a=TeacherTimetableCellValues.reduce((l,r)=>{let o=0,n=0,x=0,d=0,c=0;const u={Monday:r.Text2!=="0",Tuesday:r.Text3!=="0",Wednesday:r.Text4!=="0",Thursday:r.Text5!=="0",Friday:r.Text6!=="0"};return r.Text1!=="99"&&(o=mpt&&isMPTLecture(t,r.Text1)?1:0,n=assembly&&isAssemblyLecture(t,r.Text1)?1:0,x=stayback&&isStaybackLecture(t,r.Text1)?1:0,d=weeklytest&&isWeeklyTestLecture(t,r.Text1)?1:0,c=u[t]?1:0),l+o+n+x+d+c},0);s[t](Number(a))})}},[TeacherTimetableCellValues,trackTeacherTimetable,ApplicablesToggleData,assembly,mpt,stayback,weeklytest,StayBackInfo,weeklyTestInfo,AssemblyInfo,mptInfo]),reactExports.useEffect(()=>{ApplicablesToggleData.length>0&&ApplicablesToggleData.map((e,s)=>{setAssembly(e.Assembly==="Y"),setMPT(e.MPT==="Y"),setWeekly(e.Weeklytest==="Y"),setStayback(e.Stayback==="True")})},[ApplicablesToggleData]),reactExports.useEffect(()=>{if(ApplicablesData.length!=0){const e={asSchoolId:Number(localStorage.getItem("localSchoolId")),asTeacher_Id:Number(sessionStorage.getItem("TeacherId")),asConsiderAssembly:ApplicablesData[0].Assemble,asConsiderMPT:ApplicablesData[0].MPT,asConsiderStayback:"Y",asConsiderWeeklyTest:"Y"};dispatch(GetLectureCountsForTeachers(e))}},[ApplicablesData]),reactExports.useEffect(()=>{if(TeacherTimetableCellValues.length>0&&WeekdayIds.length>0&&(MondayColumnList==null?void 0:MondayColumnList.length)>0&&(TuesdayColumnList==null?void 0:TuesdayColumnList.length)>0&&(WednesdayColumnList==null?void 0:WednesdayColumnList.length)>0&&(ThursdayColumnList==null?void 0:ThursdayColumnList.length)>0&&(FridayColumnList==null?void 0:FridayColumnList.length)>0){setTrackTeacherTimetable({});const e={},s=[MondayColumnList,TuesdayColumnList,WednesdayColumnList,ThursdayColumnList,FridayColumnList],t=WeekdayIds.map(a=>a.WeekdayId);TeacherTimetableCellValues.forEach(a=>{const l=a.Text1;["Text2","Text3","Text4","Text5","Text6"].forEach((r,o)=>{var d,c,u,T;let n=s[o].filter(b=>b.Id===a[r]);const x=`${t[o]}-${l}`;e[x]=`${a[r]}-${t[o]}-${((d=n[0])==null?void 0:d.StdDivId)===void 0?"0":(c=n[0])==null?void 0:c.StdDivId}-${((u=n[0])==null?void 0:u.SubId)===void 0?"0":(T=n[0])==null?void 0:T.SubId}-${l}`})}),setTrackTeacherTimetable(e)}},[TeacherTimetableCellValues,WeekdayIds,MondayColumnList,TuesdayColumnList,WednesdayColumnList,ThursdayColumnList,FridayColumnList]),reactExports.useEffect(()=>{const e={asSchoolId:Number(localStorage.getItem("localSchoolId")),asAcademicYearID:Number(sessionStorage.getItem("AcademicYearId")),asTeacher_Id:Number(sessionStorage.getItem("TeacherId")),asStandardDivision_Id:Number(sessionStorage.getItem("StandardDivisionId"))};dispatch(GetDataForAdditionalClasses(e))},[]);const HeaderArray=[{Id:1,Header:"WeekDays >>"},{Id:2,Header:"Monday"},{Id:3,Header:"Tuesday"},{Id:4,Header:"Wednesday"},{Id:5,Header:"Thursday"},{Id:6,Header:"Friday"}],[isEmpty,setIsEmpty]=reactExports.useState(!1);reactExports.useEffect(()=>{TimeTableList.length>0&&TimeTableList.map((e,s)=>{e.Text1==="Total Lectures"&&e.Text2==="0"&&e.Text3==="0"&&e.Text4==="0"&&e.Text5==="0"&&e.Text6==="0"?setIsEmpty(!0):setIsEmpty(!1)})},[TimeTableList]);function countSubIdOccurrences(e,s){let t=0;if(Object.keys(trackTeacherTimetable).length>0){for(const a in trackTeacherTimetable)if(trackTeacherTimetable.hasOwnProperty(a)){const l=trackTeacherTimetable[a],[,,r,o]=l.split("-");o===e&&r===s&&t++}}return t}function filterMaxDayLec(e,s){const t=Number(s.split(" ")[1]);let a=e.filter(l=>t<=parseInt(l.MaxDayLec));return a.unshift({Id:"0",Name:"Select",Value:"0",StdDivId:"0",SubId:"0",TeacherId:"0",MaxDayLec:"0"}),a}function hadExternalLecLabel(e,s){let t=s.split(" ")[1];return isMPTLecture(e,t)?'<b><font color="#017df6" face="Verdana" size="2">M.P.T</font></b><br/><font color="#000000" face="Verdana" size="1">':isAssemblyLecture(e,t)?'<b><font color="#017df6" face="Verdana" size="2">Assembly</font></b><br/><font color="#000000" face="Verdana" size="1">':isStaybackLecture(e,t)?'<b><font color="#017df6" face="Verdana" size="2">Stayback</font></b><br/><font color="#000000" face="Verdana" size="1">':isWeeklyTestLecture(e,t)?'<b><font color="#017df6" face="Verdana" size="2">Weekly Test</font></b><br/><font color="#000000" face="Verdana" size="1">':""}return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(Box,{sx:{mb:5,mx:2},children:[jsxRuntimeExports.jsx(CommonPageHeader,{navLinks:[{title:"Timetable",path:"/RITeSchool/teacher-timetable"}],rightActions:jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx(Tooltip,{title:"Your timetable for the week",children:jsxRuntimeExports.jsx(IconButton,{sx:{color:"white",backgroundColor:grey[500],"&:hover":{backgroundColor:grey[600]}},children:jsxRuntimeExports.jsx(default_1,{})})})})}),isEmpty&&jsxRuntimeExports.jsx(Box,{sx:{background:"white",p:2},children:jsxRuntimeExports.jsx(Typography,{variant:"body1",sx:{textAlign:"center",marginTop:4,backgroundColor:"#324b84",padding:1,borderRadius:2,color:"white"},children:jsxRuntimeExports.jsx("b",{children:"Timetable not yet configured."})})}),!isEmpty&&jsxRuntimeExports.jsxs(Box,{sx:{p:2,background:"white"},children:[jsxRuntimeExports.jsx(Stack,{direction:"row",gap:1,alignItems:"center",justifyContent:"space-between"}),jsxRuntimeExports.jsxs(Box,{sx:{mt:1},children:[jsxRuntimeExports.jsx(Stack,{direction:"row",gap:1,alignItems:"center",justifyContent:"space-between",mb:1,children:jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center",mt:1},children:[jsxRuntimeExports.jsx(Typography,{variant:"h6",sx:{color:blue[500],mr:1},children:"Legend:"}),jsxRuntimeExports.jsxs(Box,{sx:{display:"flex",alignItems:"center"},children:[jsxRuntimeExports.jsx(Box,{sx:{width:50,height:30,display:"flex",justifyContent:"center",alignItems:"center",border:"1px solid black",fontWeight:"bold",mr:1,borderRadius:"4px",padding:"4px"},children:"N / C"}),jsxRuntimeExports.jsx(Typography,{children:"Not Configured"})]})]})}),jsxRuntimeExports.jsx(TableContainer,{component:Box,children:jsxRuntimeExports.jsxs(Table,{children:[jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsx(TableRow,{children:HeaderArray.map((e,s)=>jsxRuntimeExports.jsx(HeaderStyledCell,{children:e.Header}))})}),jsxRuntimeExports.jsx(TableBody,{children:TimeTableList==null?void 0:TimeTableList.map((item,i)=>item.Text1==="Total Lectures"?jsxRuntimeExports.jsx(TableRow,{children:Object.keys(trackTeacherTimetable).length>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FooterStyledCell,{children:"Total Lectures"}),jsxRuntimeExports.jsx(FooterStyledCell,{children:ApplicablesToggleData.length>0&&MonCount}),jsxRuntimeExports.jsx(FooterStyledCell,{children:ApplicablesToggleData.length>0&&TueCount}),jsxRuntimeExports.jsx(FooterStyledCell,{children:ApplicablesToggleData.length>0&&WedCount}),jsxRuntimeExports.jsx(FooterStyledCell,{children:ApplicablesToggleData.length>0&&ThuCount}),jsxRuntimeExports.jsx(FooterStyledCell,{children:ApplicablesToggleData.length>0&&FriCount})]})}):jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(StyledCell,{dangerouslySetInnerHTML:{__html:item.Text1}}),["Monday","Tuesday","Wednesday","Thursday","Friday"].map((day,index)=>{const content=hadExternalLecLabel(day,item.Text1)!==""?hadExternalLecLabel(day,item.Text1):filterMaxDayLec(eval(`${day}ColumnList`),item.Text1).length===1?'<span color="#f1f5f9" >N / A</span>':item[`Text${index+2}`];return jsxRuntimeExports.jsx(StyledCell,{dangerouslySetInnerHTML:{__html:content},className:content.includes("N / A")||content==="N / C"?`grey-background ${content==="N / C"?"bold-text":""}`:""},day)})]},i))})]})})]}),jsxRuntimeExports.jsx(Divider,{sx:{my:2}}),jsxRuntimeExports.jsxs(Stack,{direction:"row",gap:2,children:[jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(Typography,{variant:"body1",sx:{textAlign:"center",backgroundColor:"#324b84",padding:1,borderRadius:2,color:"white",marginBottom:.5},children:"Class-Subject Lecture Count"}),jsxRuntimeExports.jsx(TableContainer,{sx:{width:"100%"},children:jsxRuntimeExports.jsxs(Table,{children:[jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(HeaderStyledCell,{children:"Class Subjects"}),jsxRuntimeExports.jsx(HeaderStyledCell,{children:"Lecture Count"})]})}),jsxRuntimeExports.jsx(TableBody,{children:LectureCountsForTeachers==null?void 0:LectureCountsForTeachers.map((e,s)=>{let t;const[a,l,r,o]=ExtLectCount==null?void 0:ExtLectCount.split("-");switch(e.Text2){case"Assembly":t=assembly?e.Text3:"0";break;case"M.P.T.":t=mpt?e.Text3:"0";break;case"Stay Back":t=stayback?e.Text3:"0";break;case"Weekly Tests":t=weeklytest?e.Text3:"0";break;default:t=e.Text3;break}function n(){let x=0;for(const d in trackTeacherTimetable)if(trackTeacherTimetable.hasOwnProperty(d)){const c=trackTeacherTimetable[d];(c==null?void 0:c.split("-")).slice(0,-1).every(b=>b!=="0")&&x++}return x}return e.Text2==="Total Weekly Lectures"?jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(FooterStyledCell,{sx:{textAlign:"left"},dangerouslySetInnerHTML:{__html:e.Text2}}),jsxRuntimeExports.jsx(FooterStyledCell,{sx:{textAlign:"center"},children:n()+(mpt&&Number(a))+(stayback&&Number(l))+(weeklytest&&Number(o))+(assembly&&Number(r))})]},s):["Assembly","M.P.T.","Stay Back","Weekly Tests"].includes(e.Text2)?jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(StyledCell1,{sx:{textAlign:"left"},children:e.Text2}),jsxRuntimeExports.jsx(StyledCell1,{sx:{textAlign:"center"},children:t})]},s):jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(StyledCell1,{sx:{textAlign:"left"},children:e.Text2}),jsxRuntimeExports.jsx(StyledCell1,{sx:{textAlign:"center"},children:countSubIdOccurrences(e.Text5,e.Text4)})]},s)})})]})})]}),jsxRuntimeExports.jsxs(Box,{sx:{flex:1},children:[jsxRuntimeExports.jsx(Typography,{variant:"body1",sx:{textAlign:"center",backgroundColor:"#324b84",padding:1,borderRadius:2,color:"white",marginBottom:.5},children:"Additional Lectures"}),(TimetableDetails==null?void 0:TimetableDetails.length)===0&&jsxRuntimeExports.jsx(Typography,{variant:"body1",sx:{textAlign:"center",marginTop:30,backgroundColor:"#324b84",padding:1,borderRadius:2,color:"white"},children:jsxRuntimeExports.jsx("b",{children:"No additional lectures assigned."})}),(TimetableDetails==null?void 0:TimetableDetails.length)>0&&jsxRuntimeExports.jsx(TableContainer,{sx:{width:"100%"},children:jsxRuntimeExports.jsxs(Table,{children:[jsxRuntimeExports.jsx(TableHead,{children:jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(HeaderStyledCell,{children:"WeekDay"}),jsxRuntimeExports.jsx(HeaderStyledCell,{children:"Lecture Number"}),jsxRuntimeExports.jsx(HeaderStyledCell,{children:"Class"}),jsxRuntimeExports.jsx(HeaderStyledCell,{children:"Subject "})]})}),jsxRuntimeExports.jsx(TableBody,{children:TimetableDetails==null?void 0:TimetableDetails.map((e,s)=>jsxRuntimeExports.jsxs(TableRow,{children:[jsxRuntimeExports.jsx(TableCell,{sx:{border:"1px solid rgba(224, 224, 224, 1)",paddingTop:"10px",paddingBottom:"10px"},children:e.Text2}),jsxRuntimeExports.jsx(TableCell,{sx:{border:"1px solid rgba(224, 224, 224, 1)",paddingTop:"10px",paddingBottom:"10px",textAlign:"center"},children:e.Text1}),jsxRuntimeExports.jsx(TableCell,{sx:{border:"1px solid rgba(224, 224, 224, 1)",paddingTop:"10px",paddingBottom:"10px",textAlign:"center"},children:e.Text4}),jsxRuntimeExports.jsx(TableCell,{sx:{border:"1px solid rgba(224, 224, 224, 1)",paddingTop:"10px",paddingBottom:"10px",textAlign:"left"},children:e.Text3})]}))})]})})]})]})]})]})})};export{TeacherTimetable as default};
