import{h as pe,bj as nt,r as s,j as e,B as r,T as d,bl as A,D as oe,af as at,ag as rt,ah as it,ai as ne,aj as m,ak as lt,S as ct,A as dt,t as _,z as mt,ab as pt,c as ae,q as ut,v as ht,ad as xt,u as gt,d$ as St,e0 as ft,az as bt,C as jt,E as R,I as z,F as w,H,J as Y,c1 as Ct,L as yt,M as Tt,N as It,O as Mt,Q as $,G as i,o as v,c7 as q,bH as Q,a6 as D,b1 as Rt,aG as vt,a0 as re,a1 as ie,bd as le,a3 as ce,a5 as Dt}from"./index-CpZD2H93.js";import{d as At}from"./Info-DvyShze9.js";import{d as Nt}from"./Send-deSjc6sZ.js";import{u as kt}from"./formik.esm-Crucl9hw.js";import{T as wt}from"./TimepickerTwofields-CJ0DH21z.js";import{A as Pt}from"./AddReciepents-nwWB8U-u.js";import{E as de}from"./Errormessage-DVJGTehf.js";import{C as Ft}from"./CardStyle-CBuNm0_N.js";import{d as Et}from"./ArrowCircleUp-C3u-oYJu.js";import{d as Bt}from"./ArrowCircleDown-CuaRBylZ.js";import{C as Wt}from"./Card-B0aZ7mGs.js";import{C as Lt}from"./CardContent-BwlSJArJ.js";import{R as me}from"./Radio-IVxzoZco.js";import{T as Ot}from"./TableSortLabel-CreUVxXh.js";import"./GroupAdd-YcnFVjzY.js";import"./Square-CVQpjtQG.js";import"./ListSelect-CwnzciXr.js";import"./CheckboxImg-BrcA302U.js";import"./RadioButtonUnchecked-r_6mn_G1.js";import"./ArrowCircleDown-7BHmj5tB.js";import"./ListHeaderCard3ColSel-e-z25ypD.js";import"./DoNotDisturbOn-Dociqe_h.js";import"./QuestionMark-B_7MKkiz.js";const Gt=({rows:P})=>{const h=pe(),f=nt(h.breakpoints.down("sm")),[x,N]=s.useState("asc"),[p,u]=s.useState(null),b=n=>{u(n),N(g=>g==="asc"?"desc":"asc")},j=[...P].sort((n,g)=>{if(p==="name"){if(n.name<g.name)return x==="asc"?-1:1;if(n.name>g.name)return x==="asc"?1:-1}return 0});return e.jsxs(r,{children:[e.jsxs(r,{display:"flex",alignItems:"center",sx:{mb:2,backgroundColor:"white"},children:[e.jsx(d,{variant:"body2",sx:{mr:1,fontWeight:"bold"},children:"Legend"}),e.jsx(r,{sx:{width:16,height:16,backgroundColor:A[50],border:"1px solid #ddd",mr:1}}),e.jsx(d,{variant:"body2",children:"System Template"})]}),f?e.jsx(r,{children:j.map(n=>e.jsx(Wt,{sx:{mb:2,backgroundColor:A[50]},children:e.jsxs(Lt,{children:[e.jsxs(r,{display:"flex",alignItems:"center",children:[e.jsx(me,{color:"primary"}),e.jsxs(d,{variant:"body2",sx:{fontWeight:"bold"},children:["Registration No.: ",n.registrationNo]})]}),e.jsx(oe,{sx:{my:1}}),e.jsx(d,{variant:"body2",sx:{fontWeight:"bold"},children:"Name:"}),e.jsx(d,{variant:"body2",children:n.name}),e.jsx(oe,{sx:{my:1}}),e.jsx(d,{variant:"body2",sx:{fontWeight:"bold"},children:"Template:"}),e.jsx(d,{variant:"body2",children:n.template})]})},n.registrationNo))}):e.jsx(at,{component:r,children:e.jsxs(rt,{"aria-label":"simple table",sx:{border:n=>`1px solid ${n.palette.grey[300]}`,overflow:"hidden"},children:[e.jsx(it,{children:e.jsxs(ne,{sx:{background:h.palette.secondary.main,color:h.palette.common.white},children:[e.jsx(m,{}),e.jsx(m,{sx:{color:"white",textAlign:"left"},children:"Registration No."}),e.jsx(m,{sx:{color:"white",textAlign:"left"},children:e.jsx(Ot,{active:p==="name",direction:x,onClick:()=>b("name"),IconComponent:x==="asc"?Et:Bt,sx:{color:"white !important","& .MuiTableSortLabel-icon":{color:"white !important"}},children:"Name"})}),e.jsx(m,{sx:{color:"white",textAlign:"left"},children:"Template"})]})}),e.jsx(lt,{children:j.map(n=>e.jsxs(ne,{children:[e.jsx(m,{children:e.jsx(me,{color:"primary"})}),e.jsx(m,{children:n.registrationNo}),e.jsx(m,{children:n.name}),e.jsx(m,{children:n.template})]},n.registrationNo))})]})})]})},Ss=()=>{const P=ct(),h=dt();pe(),_.configure();const[f,x]=s.useState(!1),{showAlert:N,closeAlert:p}=s.useContext(mt),[u,b]=s.useState(""),[j,n]=s.useState(""),[g,F]=s.useState(!1),[ue,J]=s.useState(!1),[Ut,he]=s.useState("none"),[_t,xe]=s.useState("block");s.useState(""),s.useState("none"),s.useState(""),pt.useState(new Date),s.useState(!1),s.useState("");const[ge,V]=s.useState(""),[c,E]=s.useState({RecipientName:[],RecipientId:[],ClassId:[],ContactGroup:[]}),[Se,fe]=s.useState("00:00"),C=new Date;C.getHours()%12,C.getMinutes(),s.useState(""),C.getDate().toString().padStart(2,"0"),(C.getMonth()+1).toString().padStart(2,"0"),C.getFullYear();let y=new Date;y.setDate(y.getDate()+7),y.getDate().toString().padStart(2,"0"),(y.getMonth()+1).toString().padStart(2,"0"),y.getFullYear(),ae(t=>t.getAComposeSMS.AComposeSMSTemplateList).GetSMSTemplates;const[T,K]=s.useState(),[be,Ht]=s.useState(),[Yt,je]=s.useState(),[Ce,$t]=s.useState(0),[ye,Te]=s.useState(0);let{AssignedDate:k}=ut();k=ht(k);const[X,Ie]=s.useState({scheduleSMS:!1,scheduledDate:null,scheduledTime:null});s.useState({scheduledDate:!1,scheduledTime:!1});const Me=xt(),{state:a}=Me;s.useEffect(()=>{var t;if(a!=null&&a.activeNoList){let o=(t=a==null?void 0:a.activeNoList)==null?void 0:t.split(",");const S=o==null?void 0:o.map(l=>l.trim());b(u==null?void 0:u.concat(S))}},[a]),s.useEffect(()=>{(a==null?void 0:a.Display_Text)!==void 0&&(K(a==null?void 0:a.SMS_Text),E({RecipientName:a==null?void 0:a.Display_Text.split(","),RecipientId:a==null?void 0:a.UserId.split(",")}))},[a]);const B=()=>{F(!1)},Re=()=>{F(!1),V("true")},Z=()=>{J(!1)},ve=t=>{je(!1)},[qt,I]=s.useState(),De=t=>{t.target.length>0&&I(!1),t.target.length==0&&I(!0)},Ae=t=>{t.target.value.length==0&&I(!0),t.target.value.length>0&&I(!1)},Ne=t=>{I(!1)},ke=gt(),[ee,te]=s.useState(c.RecipientName||[]);s.useEffect(()=>{te(c.RecipientName||[])},[c.RecipientName]),ae(t=>t.getASendSMS.ASendSMS);const we=t=>{V(""),F(!0)},Pe=t=>{J(!0)},Fe=t=>{t.split(",").map(l=>l.trim()).filter(l=>l.length!==10||isNaN(l)).length>0?n("Each number must be 10 digits."):n("")},Ee=t=>{const o=t.target.value;b(o),Fe(o)},Be=()=>{x(t=>!t),f&&(b(""),n(""))},We=[{registrationNo:"1007006514077798929",name:"AdmissionLotterySMS",template:"Congratulations!!! Your child has been selected in admission lottery of Pawar Public School. Please pay the fees by %DATE% to confirm the admission."},{registrationNo:"1007271844150293720",name:"ChequePaymentSMS",template:"We have successfully received your fee payment of Rs. %Amount% through %PaymentMode%. Regards, PPS Pune. *Subject To Cheque Realization."},{registrationNo:"1007328126928263539",name:"Holiday SMS",template:"Dear Parents, The school will remain closed on {#var#} on account of {#var#}. Regards, PPS Hadapsar"},{registrationNo:"1007743695402120671",name:"QuarterlyPendingFeeSMS",template:"Fees for {#var#} is due on {#var#}. Pay using online facility thru RTE login. Cheque box available in school. Kindly Ignore, if paid. â€“ PPS, Accounts Dept"}],Le=sessionStorage.getItem("AcademicYearId"),W=localStorage.getItem("localSchoolId"),se=sessionStorage.getItem("Id"),Oe=localStorage.getItem("SchoolName"),Ge=sessionStorage.getItem("RoleId"),L=JSON.parse(localStorage.getItem("SchoolSettingsValue")),O=L==null?void 0:L.SMSSenderUserName,Ue={asSchoolId:W,sortDirection:"asc",asShowSystemDefined:"Y"},M=kt({initialValues:{From:O,To:c.RecipientName.toString(),Content:T},onSubmit:()=>{_e()},validate:t=>{const o={};return c.RecipientName.toString().length==0&&(o.To="Atleast one recipient should be selected."),(T==null||T=="")&&(o.Content="SMS content should not be blank please select SMS Template"),o}}),_e=()=>{const t={asSchoolId:W,aoMessage:{Body:T,Subject:"",SenderName:O,DisplayText:c.RecipientName.toString(),SenderUserId:se,SenderUserRoleId:Ge,AcademicYearId:Le,SchoolId:W,InsertedById:se,Attachment:""},asSelectedUserIds:c.RecipientId.toString(),asSelectedStDivId:"",asIsSoftwareCordinator:0,asMessageId:0,sIsReply:"N",asIsForward:"N",asSchoolName:Oe,asTemplateRegistrationId:be};St.SendSMS(t).then(o=>{o.status===200&&(_.success("SMS sent successfully"),h("/RITeSchool/SMSCenter/smsCenter",{state:{fromInternal:!0}}),M.resetForm())}).catch(o=>{_.error("SMS does not sent successfully")})};s.useMemo(()=>{ke(ft(Ue))},[]);const ze=["Do not use any website URL or mobile number in SMS text. Such SMS will not get delivered to selected recipient(s)."],He=["SMS Schedule should be set after 1 hour and within 7 days range from now."],Ye=["Enter multiple mobile numbers seperated by comma. Max 10 digit number."];s.useState(!1);const $e=t=>{st(t),E(t),he("none"),xe("block")},qe=t=>{K(t),Te(t.length)},Qe=t=>{const{name:o,value:S}=t.target;Ie(l=>({...l,[o]:S}))},Je=t=>{fe(t)},[Ve,Ke]=s.useState(k==null?new Date().toISOString().split("T")[0]:bt(k)),Xe=t=>{Ke(t)},Ze=t=>{t!==void 0&&sessionStorage.setItem("GroupSelectionId",t)},et=t=>{t!==void 0&&sessionStorage.setItem("GroupSelectionId1",t)},tt=()=>{Re()},st=t=>{sessionStorage.getItem("GroupSelectionId")==="9"&&t.ContactGroup.length===0&&t.RecipientName.length===0?N({title:"Please Confirm",message:"No group is selected. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{p()},onConfirm:()=>{p()}}):t.RecipientName.length===0&&N({title:"Please Confirm",message:"No User is selected. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{p()},onConfirm:()=>{p()}})},ot=(t,o)=>{const S=ee.filter((l,G)=>G!==o);te(S),E(l=>({...l,RecipientName:l.RecipientName.filter((G,U)=>U!==o),RecipientId:l.RecipientId.filter((G,U)=>U!==o)}))};return e.jsx(e.Fragment,{children:e.jsxs(r,{sx:{px:2},children:[e.jsx(jt,{navLinks:[{title:"SMS Center",path:"/RITeSchool/Teacher/SmsCenter"},{title:"Compose SMS",path:""}],rightActions:e.jsxs(e.Fragment,{children:[e.jsx(R,{title:"Send SMS to individual student / teacher or the entire school. To send sms to other mobile numbers check Add Mobile Numbers Manually checkbox and enter mobile numbers separated by comma.",children:e.jsx(z,{sx:{color:"white",backgroundColor:w[500],"&:hover":{backgroundColor:w[600]}},children:e.jsx(H,{})})}),e.jsx(R,{title:"Send SMS",children:e.jsx(z,{onClick:M.handleChange,sx:{color:"white",backgroundColor:Y[500],"&:hover":{backgroundColor:Y[600]}},children:e.jsx(Nt,{})})})]})}),e.jsx(Ct,{sx:{mb:"10px"},children:e.jsxs(yt,{defaultExpanded:!0,children:[e.jsx(Tt,{expandIcon:e.jsx(It,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsx(d,{style:{fontWeight:"bold",fontSize:"20px"},children:"Important Notes"})}),e.jsxs(Mt,{sx:{gap:.1,display:"flex",flexDirection:"column"},children:[e.jsx($,{variant:"filled",severity:"info",sx:{mb:1,mt:"0.1px"},children:ze}),e.jsxs($,{variant:"filled",severity:"info",sx:{mb:1,mt:"0.1px"},children:[" ",He]}),e.jsx($,{variant:"filled",severity:"info",children:Ye})]})]})}),e.jsx(r,{sx:{backgroundColor:"white"},children:e.jsxs("form",{onSubmit:M.handleSubmit,children:[e.jsxs(i,{container:!0,children:[e.jsx(i,{xs:12,mt:3.3,px:2,sm:2,md:3,lg:3,children:e.jsx(v,{sx:{marginTop:"20px"},variant:"outlined",fullWidth:!0,name:"From",label:"From",id:"from",InputProps:{readOnly:!0},value:O})}),e.jsxs(i,{xs:12,sm:7,md:6,lg:7.1,spacing:1,px:2,children:[e.jsx(q,{control:e.jsx(Q,{checked:f,onChange:Be,color:"primary"}),label:"Add Mobile Numbers Manually"}),e.jsx(v,{disabled:!f,multiline:!0,fullWidth:!0,placeholder:"Enter multiple mobile numbers separated by commas",value:u,onChange:Ee,error:!!j,helperText:j||"(Enter multiple mobile numbers separated by comma. Max 10-digit numbers.)",sx:{marginTop:"8px",height:"50px",borderRadius:"5px"}})]}),e.jsx(i,{xs:12,mt:6,sm:2,md:1,lg:1.9,children:e.jsx(r,{sx:{mt:{xs:"10px",sm:"10px",md:"10px",lg:"10px"}},children:e.jsx(D,{fullWidth:!0,sx:{color:"#38548A",mt:.7,width:"187px","&:hover":{color:"#38548A",backgroundColor:A[100]}},onClick:()=>{h("/RITeSchool/teacher/PersonalAddressBook",{state:{mobileNumbers:u,fromInternal:!0}})},children:"Personal Address book"})})})]}),e.jsxs(i,{container:!0,gap:2,children:[e.jsxs(i,{xs:12,sm:9,md:10,lg:10.2,px:2,children:[e.jsx(r,{sx:{mt:{xs:"10px",sm:"30px",md:"10px",lg:"10px"}},children:e.jsx(v,{label:e.jsxs("span",{style:{color:"#38548A",marginTop:"10px"},children:["To ",e.jsx("span",{style:{color:"red"},children:"*"})]}),multiline:!0,className:P.InputField,onChange:De,onBlur:Ae,onFocus:Ne,InputProps:{startAdornment:e.jsx(r,{sx:{display:"flex",flexWrap:"wrap",overflowY:"scroll",minWidth:"100%",height:"100px"},children:ee.map((t,o)=>e.jsx(Rt,{label:t==null?void 0:t.trim(),onDelete:()=>ot(t,o),sx:{my:1,mx:.5}},o))}),readOnly:!0},value:"",id:"body",fullWidth:!0})}),e.jsx("div",{style:{marginTop:"15px"},children:e.jsx(de,{Error:M.errors.To})})]}),e.jsx(i,{xs:12,sm:2,md:1,lg:1.2,mt:2,children:e.jsx(r,{sx:{mt:{xs:"10px",sm:"30px",md:"50px",lg:"50px"}},children:e.jsx(D,{fullWidth:!0,onClick:()=>we(),sx:{color:"#38548A",mt:.7,width:"140px","&:hover":{color:"#38548A",backgroundColor:A[100]}},children:"Add Recipients"})})})]}),e.jsxs(i,{container:!0,spacing:2,px:2,mt:0,children:[e.jsx(i,{item:!0,xs:12,sm:6,md:2,lg:2,children:e.jsx(q,{control:e.jsx(Q,{name:"SendMessage"}),label:"Send Message"})}),e.jsxs(i,{item:!0,xs:12,sm:6,md:4,lg:2,children:[e.jsx(q,{control:e.jsx(Q,{name:"scheduleSMS",checked:X.scheduleSMS,onChange:Qe}),label:"Schedule SMS"}),e.jsx(R,{title:`10:00 AM. SMS Schedule should be set after 1 hour\r
                                        and within 7 days range from now.`,children:e.jsx(z,{size:"small",style:{marginLeft:8,color:"#38548A"},children:e.jsx(At,{fontSize:"small"})})})]}),X.scheduleSMS&&e.jsxs(e.Fragment,{children:[e.jsx(i,{item:!0,xs:12,sm:6,md:3,lg:2.1,children:e.jsx(vt,{DateValue:Ve,onDateChange:Xe,size:"medium",label:"Date"})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,lg:2,children:e.jsx(wt,{Item:Se,label:"Time",isMandatory:!1,ClickItem:Je,size:"medium",tooltipMessage:"e.g. 10:00 AM"})})]}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,lg:1.5,children:e.jsx(v,{name:"TemplateId",label:"Template Id",variant:"outlined",fullWidth:!0})}),e.jsx(i,{xs:2,mt:2,sm:2,md:1.7,children:e.jsx(r,{children:e.jsx(D,{fullWidth:!0,sx:{color:"#38548A",mt:.7,width:"130px","&:hover":{color:"#38548A",backgroundColor:A[100]}},onClick:()=>Pe(),children:"Use Template"})})})]}),e.jsxs(r,{px:2,children:[e.jsxs(Ft,{sx:{color:"blue",marginTop:0,marginBottom:1.5,fontWeight:"bold"},children:[" ","Letters = ",ye," Message = ",Ce," "]}),e.jsx(v,{fullWidth:!0,multiline:!0,rows:4,margin:"normal",name:"Content",type:"text",value:T,onBlur:ve,sx:{marginTop:"1px"},id:"content",onChange:t=>qe(t.target.value)}),e.jsx(r,{style:{marginTop:"8px"},children:e.jsx(de,{Error:M.errors.Content})})]})]})}),e.jsxs(re,{open:g,onClose:B,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:"15px"}},children:[e.jsxs(ie,{sx:{bgcolor:"#223354"},children:[e.jsx(R,{title:'Select name of the teacher / student / admin staff / other staff and click on " Confirm " button.',placement:"bottom-end",children:e.jsx(H,{sx:{color:"white",borderRadius:"10px",position:"absolute",top:"4px",right:"35px",cursor:"pointer","&:hover":{backgroundColor:w[600]}}})}),e.jsx(le,{onClick:B,sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"8px",cursor:"pointer","&:hover":{color:"red"}}})]}),e.jsx(d,{variant:"h3",sx:{pt:2,pl:3},children:"Add Recipients"}),e.jsx(ce,{children:e.jsx(r,{children:e.jsx(Pt,{getGroupRadio:Ze,RecipientName:c.RecipientName,RecipientId:c.RecipientId,recipientListClick:$e,contactGroupList:c.ContactGroup,classIdList:c.ClassId,IsConfirm:ge,getGroupRadio1:et})})}),e.jsxs(Dt,{sx:{m:2},children:[e.jsx(D,{onClick:B,color:"error",children:"Cancel"}),e.jsx(D,{onClick:()=>{tt()},sx:{color:"green","&:hover":{color:"green",backgroundColor:Y[100]}},children:"Confirm"})]})]}),e.jsxs(re,{open:ue,onClose:Z,fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:"15px"}},children:[e.jsxs(ie,{sx:{bgcolor:"#223354"},children:[e.jsx(R,{title:"Select the required template to create the SMS.",placement:"bottom-end",children:e.jsx(H,{sx:{color:"white",borderRadius:"10px",position:"absolute",top:"4px",right:"35px",cursor:"pointer","&:hover":{backgroundColor:w[600]}}})}),e.jsx(le,{onClick:Z,sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"8px",cursor:"pointer","&:hover":{color:"red"}}})]}),e.jsx(d,{variant:"h3",sx:{pt:2,pl:3},children:"Use Template"}),e.jsx(ce,{children:e.jsx(r,{children:e.jsx(Gt,{rows:We})})})]})]})})};export{Ss as default};
