import{s as Ke,o as fe,u as Ze,A as qe,q as Je,v as Q,r as o,z as Qe,c as i,lA as es,iw as ss,nk as xe,nl as ts,jM as rs,t as ns,nm as as,j as s,B as p,C as os,n as is,G as Y,bI as v,E as M,I as T,F as he,H as ls,bl as U,na as ds,ap as ge,J as pe,aH as be,T as C,af as W,c1 as cs,ag as L,ak as y,ai as x,aj as a,ah as ee,id as E,ab as us,nn as se,ay as te}from"./index-CpZD2H93.js";import{C as ms}from"./CheckCircle-rXRTd6Pm.js";import{U as xs}from"./Unpublished-BaAgxYgB.js";import{S as hs}from"./Save-Pq9d8yJY.js";const Se=Ke(fe)({"& .MuiInputBase-root":{resize:"both",overflow:"auto",width:"100%",boxSizing:"border-box"},"& .MuiInputLabel-root":{color:"#000"},"& .MuiInputBase-input":{color:"#000"},"& .MuiOutlinedInput-root":{"& fieldset":{borderColor:"#757575"},"&:hover fieldset":{borderColor:"#000"},"&.Mui-focused fieldset":{borderColor:"#000"}}}),js=()=>{const u=Ze(),je=qe();let{Assessment:z,YearwiseStudentId:c,StandardId:b}=Je();z=Q(z),c=Q(c),b=Q(b);const[m,Ie]=o.useState(z),[Ce,we]=o.useState("0"),[N,X]=o.useState({}),{showAlert:re,closeAlert:k}=o.useContext(Qe),[ye,Ae]=o.useState("0"),[B,$]=o.useState({}),[A,ne]=o.useState(""),ae=300,[Oe,R]=o.useState(""),[Ge,V]=o.useState(""),f=Number(sessionStorage.getItem("AcademicYearId")),S=Number(localStorage.getItem("localSchoolId")),H=Number(localStorage.getItem("UserId")),oe=sessionStorage.getItem("RoleId"),ie=sessionStorage.getItem("Id"),le=i(e=>e.PreprimaryProgressReport.ISAssessmentPublishStatus),j=le.map(e=>e.AssessmentPublishStatus),l=le.map(e=>e.StudentWiseAssessmentPublishStatus),_=i(e=>e.PreprimaryProgressReport.ISFillSubjectSections),Pe=i(e=>e.PreprimaryProgressReport.ISFillSchoolDetails),O=i(e=>e.PreprimaryProgressReport.ISFillGradeDetails),de=i(e=>e.PreprimaryProgressReport.ISFillXseedRemarks),h=i(e=>e.PreprimaryProgressReport.ISFillNonXseedSubjectGrades),ve=i(e=>e.PreprimaryProgressReport.ISFillStudentDetails),ce=i(e=>e.PreprimaryProgressReport.ISFillStudentAttendance),Le=O.filter(e=>e.ConsideredAsAbsent!=="1"&&e.ConsideredAsExempted!=="1").sort((e,t)=>parseInt(e.SortOrder)-parseInt(t.SortOrder)),g=i(e=>e.PreprimaryProgressReport.ISFillStudentsLearningOutcomes);i(e=>e.PreprimaryProgressReport.ISGetStandardwiseAssessmentDetails);const Ne=[...g].sort((e,t)=>parseInt(e.LearningOutcomeSortOrder)-parseInt(t.LearningOutcomeSortOrder)),K=i(e=>e.PreprimaryProgressReport.ISManageStudentWiseAssessmentGrades),Z=i(e=>e.PreprimaryProgressReport.ISFillStudentsLearningOutcomeObservations),D=i(e=>e.PrePrimaryResult.ISlistpublishstatusDetails),G=D.length>0?D[0].IsPublished:"",P=D.length>0?D[0].PublishStatus:"",ke=i(e=>e.getSchoolSettings.getUserDetails),Re=i(e=>e.Studentwiseprogress.ISAssessmentDropdown),De=e=>e.LearningOutcomeGradeId!=="0",ue=g.map(e=>De(e)).every(e=>e);o.useEffect(()=>{const e=de.filter(t=>t.Remark);e.length>0&&ne(e[0].Remark)},[de]);const me={asSchoolId:S,asAcademicYearId:f,asStandardDivisionId:Number(c),asYearwiseStudentId:Number(b),asAssessmentId:Number(m)},Fe={asSchoolId:S,asAcademicYearId:f,asStandardId:Number(c)},Ye={asSchoolId:S,asAcadmeicYearId:f,asStdDivId:Number(c),asAssessmentId:Number(m)},Me={asAcademicYearId:Number(f),asSchoolId:Number(S)};o.useEffect(()=>{u(es(Me))},[]),o.useEffect(()=>{const e={asSchoolId:String(S),asUserId:ie,asRoleId:oe};u(ss(e))},[ie,oe]);const Te=e=>{Ie(e)};o.useEffect(()=>{u(xe(me))},[m,c,b]),o.useEffect(()=>{u(ts(Fe))},[c]),o.useEffect(()=>{u(rs(Ye))},[m]),o.useEffect(()=>{if(g.length>0){const e=g.reduce((t,r)=>(t[r.LearningOutcomeConfigId]=r.GradeId,t),{});X(e)}},[g]);function Ue(e){we(e);const t=g.reduce((r,n)=>(r[n.LearningOutcomeConfigId]=e,r),{});X(t)}const We=(e,t)=>{X(r=>({...r,[t]:e}))};o.useEffect(()=>{if(h.length>0){const e=h.reduce((t,r)=>(t[r.GradeId]=r.GradeId,t),{});$(e)}},[h]);function Ee(e){Ae(e);const t=h.reduce((r,n)=>(r[n.GradeId]=e,r),{});$(t)}const ze=(e,t)=>{$(r=>({...r,[t]:e}))};function q(){let e="";return g.forEach(t=>{const r=t.LearningOutcomeConfigId,n=N[r],d=t.SubjectSectionConfigId,F=Z.filter(I=>I.SubjectSectionConfigId===d).map(I=>I.LearningOutcomesObservationId)[0],w=_.filter(I=>I.SubjectSectionConfigId===d).map(I=>t.LearningOutcomeGradeId)[0];e+=`<LearningOutcomes GradeId='${n}' Observation='' LearningOutcomesObservationId='${F}' SubjectSectionConfigurationId='${d}' LearningOutcomeConfigId='${r}' LearningOutcomeGradeId='${w}' />`}),e=`<LearningOutcomes>${e}</LearningOutcomes>`,e}function J(){let e="";return h.forEach(t=>{const r=t.GradeId,n=B[r],d=t.SubjectId;e+=`<NonXseedSubjectGrades  GradeId='${n}' Observation='' SubjectId='${d}'/>`}),e=`<NonXseedSubjectGrades>${e}</NonXseedSubjectGrades>`,e}const Xe=e=>{e.target.value.length<=ae&&ne(e.target.value)},Be=()=>{let e=!1;const t=g.filter(n=>N[n.LearningOutcomeConfigId]=="0"),r=h.filter(n=>B[n.GradeId]=="0");if(t.length>0){const n=_.map(d=>{const F=g.filter(w=>w.SubjectSectionConfigId===d.SubjectSectionConfigurationId&&N[w.LearningOutcomeConfigId]==="0");if(F.length>0){const w=F.map((I,_e)=>_e+1).join(", ");return`${d.SubjectSectionName} : ${w}`}return null}).filter(Boolean);if(n.length>0){const d=n.join(`.
`);R(`Grade should be selected for Learning Outcome(s): ${d}`),e=!0}else R("")}else R("");if(r.length>0){const n=h.map(d=>d.SubjectName).join(", ");V(`Grade should be selected for co-curricular subject(s): ${n}`),e=!0}else V("");if(!e){const n={asSchoolId:S,asAcademicYearId:f,asYearwiseStudentId:Number(b),asStandardDivisionId:Number(c),asAssessmentId:Number(m),asInsertedById:H,asLearningOutcomeXML:q(),asXseedGradesXML:J(),asMode:"Save",asRemark:A};u(se(n))}},$e=()=>{const e={asSchoolId:S,asAcademicYearId:f,asYearwiseStudentId:Number(b),asStandardDivisionId:Number(c),asAssessmentId:Number(m),asInsertedById:H,asLearningOutcomeXML:q(),asXseedGradesXML:J(),asMode:"Publish",asRemark:A};re({title:"Please Confirm",message:"Once you publish the result it will be visible to parents/student. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{k()},onConfirm:()=>{u(se(e)),k()}})},Ve=()=>{const e={asSchoolId:S,asAcademicYearId:f,asYearwiseStudentId:Number(b),asStandardDivisionId:Number(c),asAssessmentId:Number(m),asInsertedById:H,asLearningOutcomeXML:q(),asXseedGradesXML:J(),asMode:"Unpublish",asRemark:A};re({title:"Please Confirm",message:"Once you unpublish the result it will not be visible to parents/student. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{k()},onConfirm:()=>{u(se(e)),k()}})},He=()=>{je("/RITeSchool/Teacher/PreprimaryProgressReportView/"+te(m)+"/"+te(c)+"/"+te(b),{state:{fromInternal:!0}})};return o.useEffect(()=>{K!=""&&(ns.success(K),u(as()),u(xe(me)),R(""),V(""))},[K]),s.jsxs(p,{sx:{px:2},children:[s.jsx(os,{navLinks:[{title:"Student Wise Progress Report ",path:"/RITeSchool/Teacher/StudentwiseProgressReport/"+m},{title:"Progress Report",path:"/RITeSchool/Teacher/PreprimaryProgressReport"}],rightActions:s.jsx(s.Fragment,{children:s.jsxs(is,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"left",gap:1,sx:{mt:{xs:0,sm:0},flexWrap:{xs:"nowrap",sm:"nowrap"}},children:[s.jsx(Y,{item:!0,xs:12,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-start"},children:s.jsx(v,{sx:{width:{xs:"50vw",sm:"20vw",md:"15vw"}},ItemList:Re,onChange:Te,label:"Assessment",defaultValue:m,size:"small"})}),s.jsxs(Y,{item:!0,xs:12,gap:1,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-start"},children:[s.jsx(M,{title:"Assign,publish student grades and view students progress report.",children:s.jsx(T,{sx:{color:"white",backgroundColor:he[500],height:"36px !important",":hover":{backgroundColor:he[600]}},children:s.jsx(ls,{})})}),s.jsx(M,{title:"View Progress Report",children:s.jsx("span",{children:s.jsx(T,{sx:{color:"white",backgroundColor:U[500],"&:hover":{backgroundColor:U[600]}},disabled:l=="N"||ue==!1,onClick:He,children:s.jsx(ds,{})})})}),ke.CanPublishUnpublishExam==!0&&s.jsx(M,{title:l[0]=="N"?"Publish":"Unpublish",children:s.jsx("span",{children:s.jsx(T,{sx:{color:"white",backgroundColor:l[0]=="N"?U[500]:ge[500],"&:hover":{backgroundColor:l[0]=="N"?U[600]:ge[600]}},disabled:j[0]=="Y"||ue==!1,onClick:l[0]=="N"?$e:Ve,children:l[0]=="N"?s.jsx(ms,{}):s.jsx(xs,{})})})}),s.jsx(M,{title:"Save",children:s.jsx("span",{children:s.jsx(T,{onClick:Be,sx:{color:"white",backgroundColor:pe[500],height:"36px !important",":hover":{backgroundColor:pe[600]}},disabled:j=="Y"||l=="Y",children:s.jsx(hs,{})})})})]})]})})}),s.jsx(be,{Error:Oe}),s.jsx(be,{Error:Ge}),s.jsxs(p,{border:"1px solid grey",mb:4,sx:{px:2,background:"white"},children:[s.jsx(p,{sx:{pt:2,background:"white"},children:s.jsx(Y,{container:!0,spacing:3,children:Pe.map(e=>s.jsx(Y,{item:!0,xs:12,children:s.jsxs(p,{sx:{backgroundColor:"#F0F0F0",textAlign:"center",borderLeft:"1px solid grey",borderRight:"1px solid grey"},children:[s.jsx("hr",{}),s.jsx(C,{variant:"h4",textAlign:"center",color:"#38548a",mb:0,children:e.OrganizationName}),s.jsx("hr",{}),s.jsx(C,{variant:"h4",textAlign:"center",color:"#38548a",mb:0,children:e.School_Name}),s.jsx("hr",{}),s.jsx(C,{variant:"h4",textAlign:"center",color:"#38548a",mb:0,children:"Progress Report"}),s.jsx("hr",{})]})}))})}),s.jsx(W,{component:cs,sx:{maxWidth:"100%",overflowX:"auto"},children:s.jsx(L,{children:s.jsx(y,{children:ve.map((e,t)=>s.jsxs(x,{sx:{bgcolor:"#38548A",display:"flex",flexWrap:"nowrap"},children:[s.jsx(a,{sx:{flex:"0 0 100px",minWidth:"100px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Roll No :  ",e.RollNo," "]})}),s.jsx(a,{sx:{flex:"0 0 300px",minWidth:"300px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Name :  ",e.StudentName," "]})}),s.jsx(a,{sx:{flex:"1 1 auto",minWidth:"100px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Class :  ",e.Class," "]})}),s.jsx(a,{sx:{flex:"1 1 auto",minWidth:"100px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Year :  ",e.AcademicYear," "]})}),s.jsx(a,{sx:{flex:"1 1 auto",minWidth:"200px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Assessment : ",e.Assessment," "]})}),s.jsx(a,{sx:{flex:"1 1 auto",minWidth:"200px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Attendance :  ",ce.filter(r=>r.YearwiseStudentId==e.YearWiseStudentId&&r.IsPresent=="true").length," / ",ce.filter(r=>r.YearwiseStudentId==e.YearWiseStudentId).length," "]})})]},t))})})}),s.jsxs("div",{children:[s.jsx(C,{variant:"h4",textAlign:"left",color:"#38548a",mt:2,children:"Key to Curricular and Co-Curricular"}),s.jsx(W,{component:p,children:s.jsxs(L,{"aria-label":"simple table",sx:{border:"1px solid lightgrey"},children:[s.jsx(ee,{children:s.jsxs(x,{sx:{background:e=>e.palette.secondary.main,color:e=>e.palette.common.white},children:[s.jsx(a,{sx:{textTransform:"capitalize",color:e=>e.palette.common.white,py:1},children:"Grade Name"}),s.jsx(a,{sx:{textTransform:"capitalize",color:e=>e.palette.common.white,py:1},children:"Description"})]})}),s.jsx(y,{children:Le.map(e=>s.jsxs(x,{children:[s.jsx(a,{sx:{py:1},children:e.Name}),s.jsx(a,{sx:{py:1},children:e.Description})]},e.GradeId))})]})}),s.jsx(p,{mt:1,children:s.jsx(L,{"aria-label":"simple table",sx:{border:"1px solid lightgrey"},children:s.jsx(y,{children:s.jsx(x,{sx:{bgcolor:"#F0F0F0",border:"1px solid lightgrey"},children:s.jsxs(a,{sx:{textAlign:"left",py:1,color:"black",p:1},children:[s.jsx("b",{children:"Note :  "})," Ab - Absent        Ex - Exempted "]})})})})})]}),s.jsxs(s.Fragment,{children:[s.jsx(C,{variant:"h4",textAlign:"left",color:"#38548a",mt:2,children:"Pre-Primary Curricular Subjects"}),s.jsx(W,{component:p,sx:{border:"1px solid lightgrey"},children:s.jsxs(L,{"aria-label":"simple table",children:[s.jsx(ee,{children:s.jsxs(x,{sx:{background:e=>e.palette.secondary.main,color:e=>e.palette.common.white},children:[s.jsx(a,{align:"left",sx:{color:e=>e.palette.common.white,py:1},children:"Sr. No."}),s.jsx(a,{align:"left",sx:{color:e=>e.palette.common.white,py:1},children:"Learning Outcome"}),s.jsx(a,{sx:{textTransform:"capitalize",backgroundColor:e=>e.palette.secondary.main,color:"white",pt:"10px",pb:"10px"},children:s.jsx(v,{ItemList:O,defaultValue:Ce,label:"",sx:{maxWidth:"20vw",backgroundColor:"white",marginLeft:"5px"},size:"small",DisableClearable:!0,onChange:Ue,mandatory:!0,disabled:l=="Y"&&j=="N"||G=="Y"&&P=="Y"})}),E()&&s.jsx(a,{sx:{color:e=>e.palette.common.white,py:1},children:"Facilitator's Observation"})]})}),s.jsx(y,{children:_.map(e=>s.jsxs(us.Fragment,{children:[s.jsx(x,{sx:{backgroundColor:"#F0F0F0",alignItems:"center"},children:s.jsx(a,{sx:{py:1.5,fontWeight:"bold"},colSpan:4,children:e.SubjectSectionName})}),Ne.filter(t=>t.SubjectSectionConfigId===e.SubjectSectionConfigurationId).map((t,r)=>s.jsxs(x,{children:[s.jsx(a,{sx:{py:1},children:r+1}),s.jsx(a,{sx:{py:1},children:t.LearningOutcome}),s.jsx(y,{children:t.SubjectSectionConfigId===e.SubjectSectionConfigurationId&&s.jsx(x,{children:s.jsx(a,{sx:{py:1},children:s.jsx(v,{ItemList:O,defaultValue:N[t.LearningOutcomeConfigId],label:"",sx:{width:"20vw",backgroundColor:"white"},size:"small",DisableClearable:!0,onChange:n=>We(n,t.LearningOutcomeConfigId),mandatory:!0,disabled:l=="Y"&&j=="N"||G=="Y"&&P=="Y"},t.LearningOutcomeConfigId)})})}),E()&&s.jsx(a,{sx:{color:n=>n.palette.common.white,py:1},children:Z.find(n=>n.SubjectSectionConfigId===e.SubjectSectionConfigurationId)?s.jsx(Se,{rows:1,value:Z.find(n=>n.SubjectSectionConfigId===e.SubjectSectionConfigurationId).Observation,disabled:!0,fullWidth:!0,sx:{width:"100%"}}):s.jsx("span",{})})]},t.YearwiseStudentId))]},e.SubjectSectionConfigurationId))})]})})]}),h.length>0?s.jsxs("div",{children:[s.jsx(C,{variant:"h4",textAlign:"left",color:"#38548a",mt:2,children:"Co-CurricularSubjects"}),s.jsx(W,{component:p,children:s.jsxs(L,{"aria-label":"simple table",sx:{border:"1px solid lightgrey"},children:[s.jsx(ee,{children:s.jsxs(x,{sx:{background:e=>e.palette.secondary.main,color:e=>e.palette.common.white},children:[s.jsx(a,{sx:{textTransform:"capitalize",color:e=>e.palette.common.white,py:1},children:"Subject"}),s.jsx(a,{sx:{textTransform:"capitalize",backgroundColor:e=>e.palette.secondary.main,color:"white",pt:"10px",pb:"10px"},children:s.jsx(v,{ItemList:O,defaultValue:ye,label:"",sx:{maxWidth:"20vw",backgroundColor:"white",marginLeft:"5px"},size:"small",DisableClearable:!0,onChange:Ee,mandatory:!0,disabled:l=="Y"&&j=="N"||G=="Y"&&P=="Y"})}),E()&&s.jsx("span",{children:s.jsx(a,{sx:{textTransform:"capitalize",color:e=>e.palette.common.white,py:1},children:"Facilitator's Observation"})})]})}),s.jsx(y,{children:h.map(e=>s.jsxs(x,{children:[s.jsx(a,{sx:{py:1},children:e.SubjectName}),s.jsx(a,{children:s.jsx(v,{ItemList:O,defaultValue:B[e.GradeId],label:"",sx:{width:"20vw",backgroundColor:"white"},size:"small",DisableClearable:!0,onChange:t=>ze(t,e.GradeId),mandatory:!0,disabled:l=="Y"&&j=="N"||G=="Y"&&P=="Y"},e.GradeId)},e.GradeId),E()&&s.jsx(s.Fragment,{children:s.jsx(a,{sx:{textTransform:"capitalize",color:t=>t.palette.common.white,py:1,width:"100%"},children:s.jsx(Se,{rows:1,value:e.Observation,fullWidth:!0,sx:{width:"100%"}})})})]},e.YearwiseStudentId))})]})})]}):null,s.jsx("br",{}),s.jsxs(p,{children:[s.jsx(fe,{label:s.jsx("div",{children:"Remark "}),multiline:!0,value:A,onChange:Xe,fullWidth:!0,disabled:l=="Y"&&j=="N"||G=="Y"&&P=="Y"}),s.jsxs(C,{variant:"caption",align:"right",display:"block",color:"textSecondary",children:["(",ae-A.length," )"]})]})]})]})};export{js as default};
