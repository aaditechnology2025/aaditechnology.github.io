import{j as e,af as Pe,B as y,ag as Ie,ah as Se,ai as J,aj as B,ak as Ce,E as n,I as T,ao as ye,u as Te,A as Re,q as ke,r,v as K,ar as Ne,z as ve,c as b,jM as L,jN as we,jO as Ae,t as Z,jP as De,jQ as Ee,C as Ye,n as Ue,G as m,he as ee,bl as se,ap as _,F,a0 as Be,a1 as Le,bd as _e,a3 as Fe,o as te,bs as He,a5 as Ve,a6 as re,jR as ze,jS as Ge}from"./index-CpZD2H93.js";import{d as Oe}from"./EventBusy-Cp_-meIu.js";import{C as We}from"./CheckCircle-rXRTd6Pm.js";import{U as Me}from"./Unpublished-BaAgxYgB.js";import{Q as ae}from"./QuestionMark-B_7MKkiz.js";const Qe=({ItemList:a,HeaderArray:P,clickEdit:l})=>e.jsx("div",{children:e.jsx(Pe,{component:y,children:e.jsxs(Ie,{"aria-label":"simple table",sx:{border:t=>`1px solid ${t.palette.grey[300]}`,overflow:"hidden"},children:[e.jsx(Se,{children:e.jsx(J,{sx:{background:t=>t.palette.secondary.main,color:t=>t.palette.common.white},children:P.map((t,c)=>e.jsx(B,{sx:{textTransform:"capitalize",color:d=>d.palette.common.white},children:e.jsx("b",{children:t.Header})},c))})}),e.jsx(Ce,{children:a.map(t=>e.jsxs(J,{children:[e.jsx(B,{sx:{textTransform:"capitalize",paddingTop:"2.5px",paddingBottom:"2.5px"},children:t.Subject_Name}),e.jsx(B,{sx:{textTransform:"capitalize",paddingTop:"2.5px",paddingBottom:"2.5px"},children:t.EditStatus=="Y"?e.jsx(n,{title:"Edit",children:e.jsx(T,{onClick:()=>l(t.Id,t.Subject_Name,t.IsXseedSubject),sx:{color:"#223354",cursor:"pointer"},children:e.jsx(ye,{})})}):e.jsx(n,{title:"Exam marks not submitted to the class teacher",children:e.jsx(Oe,{style:{color:"#0f0f0f"}})})})]},t.ItemID))})]})})}),rs=()=>{const a=Te(),P=Re();let{TermId:l,StdDivId:t}=ke();r.useEffect(()=>{l!==void 0&&t!==void 0&&(l=K(l),t=K(t))},[l,t]);const c=Number(localStorage.getItem("localSchoolId")),d=Number(sessionStorage.getItem("AcademicYearId")),[u,H]=r.useState("0"),[R,V]=r.useState(""),[le,z]=r.useState("");let h=Ne(163);const I=Number(sessionStorage.getItem("StandardDivisionId")),[o,G]=r.useState("0"),[ie,f]=r.useState(!1),[k,S]=r.useState(""),[O,j]=r.useState(""),C=Number(localStorage.getItem("UserId")),{showAlert:oe,closeAlert:W}=r.useContext(ve);r.useEffect(()=>{var s,i;if(t&&l&&t.length>0&&l.length>0){let p=N.filter(g=>g.Id===t),U=v.filter(g=>g.Id===l);G(l),H(t),V((s=p[0])==null?void 0:s.Name),z((i=U[0])==null?void 0:i.Name)}},[t,l]);const ne=[{Id:1,Header:"Subject"},{Id:2,Header:"Edit"}],N=b(s=>s.PrePrimaryResult.PrePrimaryResult).filter(s=>s.Is_PrePrimary=="Y"),v=b(s=>s.PrePrimaryResult.Assessment),w=b(s=>s.PrePrimaryResult.TeacherXseedSubjects),M=w.map(s=>s.EditStatus).every(s=>s==="Y"),x=b(s=>s.PrePrimaryResult.ISlistpublishstatusDetails),A=x.length>0?x[0].IsPublished:"",Q=x.length>0?x[0].PublishStatus:"",ce=x.length>0?x[0].StandardDivisionId:"",D=b(s=>s.PrePrimaryResult.Unpublish),E=b(s=>s.PrePrimaryResult.publish),de={asSchoolId:c,asAcadmicYearId:d,asTeacher_id:0},ue={asAcademicYearId:d,asSchoolId:c},Y={asSchoolId:c,asAcadmeicYearId:d,asStdDivId:h=="Y"?Number(u):I,asAssessmentId:Number(o)},he=()=>{const s={asSchoolId:c,asAcademic_Year_Id:d,asStandardDivisionId:h=="Y"?Number(u):I,asAssessmentId:Number(o),asUnPublishReason:k,asInsertedById:C,asUpdatedById:C,IsPublish:!1};a(Ge(s))},me=()=>{const s={asSchoolId:c,asAcademic_Year_Id:d,asStandardDivisionId:h=="Y"?Number(u):I,asAssessmentId:Number(o),asUnPublishReason:"",asInsertedById:C,asUpdatedById:C,IsPublish:!0};oe({title:"Please Confirm",message:"Once you publish the result it will be visible to parents/students. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{W()},onConfirm:()=>{a(ze(s)),W()}})},xe=s=>{H(s.Value),V(s.Name)},pe=s=>{G(s)},be=(s,i,p)=>{let U=h=="N"?sessionStorage.getItem("ClassName"):R==null?void 0:R.split(":")[0],g=h=="N"?sessionStorage.getItem("StandardDivisionId"):u;const q={EditStatusId:A==="Y"?"3P":"2",ClassName:U,Assesment:le,SelectTerm:o,SubjectName:i,SubjectId:s,StandardDivisionId:g,selectTeacher:"RP",fromInternal:!0};p==="Y"?P("/RITeSchool/Teacher/AssignPrePrimarySubjectGrades/",{state:q}):p==="N"&&P("/RITeSchool/Teacher/AssignProgressReportSubject/",{state:q})},fe=()=>{f(!0)},X=()=>{let s="";return v.map(i=>{i.Value==o&&(s=i.Name)}),s},[qe,je]=r.useState({}),$=()=>{let s="";for(const i of N){const p=h==="Y"?Number(u):I;if(i.Value===String(p)){s=i.Name;break}}return s},ge=()=>{k===""?j("Reason for unpublish should not be blank."):(he(),f(!1),j(""))};return r.useEffect(()=>{a(L(Y))},[u,o]),r.useEffect(()=>{a(we(ue))},[]),r.useEffect(()=>{a(Ae(de))},[]),r.useEffect(()=>{E!=""&&(Z.success(E),a(De()),a(L(Y)))},[E]),r.useEffect(()=>{D!=""&&(Z.success(D),a(Ee()),a(L(Y)),j(""),S(""))},[D]),e.jsxs(y,{sx:{px:2},children:[e.jsx(Ye,{navLinks:[{title:"Pre-Primary Progress Report Results",path:"/RITeSchool/Teacher/PrePrimaryResult"}],rightActions:e.jsx(e.Fragment,{children:e.jsxs(Ue,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"left",gap:1,sx:{mt:{xs:0,sm:0},flexWrap:{xs:"nowrap",sm:"nowrap"}},children:[e.jsx(m,{item:!0,xs:12,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-start"},children:e.jsx(ee,{ItemList:v,sx:{width:{xs:"50vw",sm:"13vw"}},onChange:s=>{pe(s.Value),z(s.Name)},defaultValue:o,label:"Assessment",size:"small"})}),e.jsx(m,{item:!0,xs:12,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-start"},children:h=="Y"&&e.jsx(ee,{ItemList:N,sx:{width:{xs:"70vw",sm:"20vw"}},onChange:s=>{xe(s),je(s.Name)},defaultValue:u,label:"Select Class Teacher",size:"small"})}),e.jsxs(m,{item:!0,xs:12,gap:1,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-end"},children:[ce==""||o=="0"?null:e.jsxs(e.Fragment,{children:[e.jsx(n,{title:"Publish",children:e.jsx(T,{sx:{color:"white",backgroundColor:se[500],"&:hover":{backgroundColor:se[600]}},disabled:!(Q=="Y"&&A=="N"&&M),onClick:me,children:e.jsx(We,{})})}),e.jsx(n,{title:"Unpublish",children:e.jsx(T,{sx:{color:"white",backgroundColor:_[500],"&:hover":{backgroundColor:_[500]}},disabled:!(Q=="Y"&&A=="Y"&&M),onClick:fe,children:e.jsx(Me,{})})})]}),e.jsx(n,{title:"View summarised results of your class for the selected assessment.Assessment result can be publish by clicking on publish button and unpublish by clicking on unpublish button.",children:e.jsx(T,{sx:{color:"white",backgroundColor:F[500],height:"36px !important",":hover":{backgroundColor:F[600]}},children:e.jsx(ae,{})})})]})]})})}),w.length>0?e.jsx(y,{sx:{p:2,background:"white",display:"flex",flexDirection:"column"},children:e.jsx(Qe,{HeaderArray:ne,ItemList:w,clickEdit:be})}):e.jsx("span",{}),e.jsxs(Be,{open:ie,onClose:()=>{f(!1)},fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{borderRadius:"15px"}},children:[e.jsxs(Le,{sx:{bgcolor:"#223354",color:s=>s.palette.common.white},children:[e.jsx(_e,{onClick:()=>{f(!1),j(""),S("")},sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"7px",cursor:"pointer","&:hover":{color:"red"}}}),e.jsx(n,{title:"Enter the reason for assessment unpublish.",placement:"bottom-end",children:e.jsx(ae,{sx:{color:"white",borderRadius:"10px",position:"absolute",top:"4px",right:"35px",cursor:"pointer","&:hover":{backgroundColor:F[600]}}})})]}),e.jsx(Fe,{children:e.jsxs(y,{sx:{maxHeight:"300px",overflowY:"auto",position:"relative",background:"white"},children:[e.jsx("h2",{children:"Enter Reason For Unpublish"}),e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(n,{title:X(),children:e.jsx(te,{fullWidth:!0,label:"Assessment",sx:{width:"95%",bgcolor:"#f0f0f0"},InputLabelProps:{shrink:!0},InputProps:{readOnly:!0},value:X()})})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(n,{title:$(),children:e.jsx(te,{fullWidth:!0,label:"Class Teacher ",sx:{width:"100%",bgcolor:"#f0f0f0"},InputProps:{readOnly:!0},InputLabelProps:{shrink:!0},value:$()})})}),e.jsx("br",{}),e.jsx(m,{item:!0,xs:12,marginTop:2,children:e.jsx(He,{fullWidth:!0,label:e.jsxs(e.Fragment,{children:["Reason For Unpublish  : ",e.jsx("span",{style:{color:"red"},children:"*"})]}),multiline:!0,value:k,onChange:s=>{S(s.target.value)},sx:{width:"100%"},error:O!=="",helperText:O})})]})]})}),e.jsxs(Ve,{sx:{py:1,px:3},children:[e.jsx(re,{onClick:()=>{f(!1),j(""),S("")},color:"error",children:"Cancel"}),e.jsx(re,{onClick:()=>{ge()},color:"error",sx:{"&:hover":{backgroundColor:_[100]}},children:"Unpublish"})]})]})]})};export{rs as default};
