import{j as e,d5 as re,S as le,r,G as h,E as X,a6 as G,n as w,bm as ie,B as T,I as z,ap as ce,aq as de,a9 as ue,T as R,bn as me,bo as pe,z as xe,c as x,hi as he,hj as B,u as ge,hk as fe,t as H,hl as Ie,hm as De,hn as ye,a0 as Se,a1 as je,F as be,bd as Ce,a3 as ve,o as W,a5 as Fe,J as Ne,ho as we,hp as Ue}from"./index-CpZD2H93.js";import{d as ke}from"./CloudUpload-C2WsbpCZ.js";import{E as Ae}from"./Errormessage-DVJGTehf.js";import{U as Ee}from"./UploadDocList-Bl2QzY_T.js";import{Q as Pe}from"./QuestionMark-B_7MKkiz.js";const Le=s=>{if(typeof s!="string")return null;const[l]=s.split(" ");if(!l)return null;const[n,o,m]=l.split("-");return!n||!o||!m?null:new Date(`${m}-${o}-${n}`)},Be=s=>{if(!(s instanceof Date)||isNaN(s.getTime()))return"";const l=String(s.getDate()).padStart(2,"0"),n=String(s.getMonth()+1).padStart(2,"0"),o=s.getFullYear();return`${l}-${n}-${o}`},$e=({DateValue:s,onDateChange:l,label:n,size:o,fullWidth:m=!0,maxDate:g=!1,minDate:i=!1,disabled:b=!1})=>{const f=s?Le(s):null,d=p=>{const I=p?Be(p):"";l(I)};return e.jsx(e.Fragment,{children:e.jsx(re,{disabled:b,value:f,onChange:d,format:"dd MMM yyyy",label:n?e.jsxs(e.Fragment,{children:[n," ",n&&e.jsx("span",{style:{color:"red"},children:"*"})]}):n===""?"":"Select Date",views:["year","month","day"],maxDate:g?new Date:void 0,minDate:i?new Date:void 0,slotProps:{textField:{variant:"outlined",fullWidth:m,size:o||"medium",inputProps:{readOnly:!0}}}})})},Ge=({ValidFileTypes:s,MaxfileSize:l,ChangeFile:n,errorMessage:o="",clickDelete:m=void 0,clickFileName:g=void 0,FileName:i="",FilePath:b="",width:f="300px",viewIcon:d=!1,deleteIcon:p=!1,FileLabel:I="",isMandatory:D=!0,height:N="auto"})=>{le();const y=r.useRef(null),[U,C]=r.useState("");r.useEffect(()=>{i==""&&(y.current.value=null)},[i]);const v=async S=>{const u=S.target.files;let F="";for(let a=0;a<u.length;a++){const j=me(u[a],s,l);j==null?(F=await pe(u[a]),C(""),o="",n({Name:u[a].name,Value:F.slice(F.indexOf(",")+1),FileExtension:u[a].name.split(".").at(-1),ErrorMsg:""})):(C(j),o="",n({Name:"",Value:"",FileExtension:"",ErrorMsg:j}),y.current.value=null)}};return e.jsxs(h,{container:!0,children:[e.jsxs(h,{item:!0,xs:12,sx:{display:"flex",alignItems:U?"flex-start":"center",justifyContent:"center",height:"auto"},children:[e.jsx(X,{title:"Supports only "+s.join(", ")+" files types up to "+(l/1e6).toString()+" MB.",children:e.jsxs(G,{sx:{width:f,height:N,border:S=>`1px dashed ${S.colors.primary.main}`,gap:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between"},color:"primary",children:[e.jsxs(w,{direction:"row",alignItems:"center",gap:1,sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[i?e.jsx(ie,{}):e.jsx(ke,{}),i==""?I||" No file selected":i,D&&e.jsx("span",{style:{color:"red"},children:"*"}),e.jsx(T,{sx:{textAlign:"center"},children:e.jsx("input",{ref:y,type:"file",accept:".bmp, .doc, .docx, .jpg, .jpeg, .pdf, .xls, .xlsx",onChange:v,style:{opacity:0,position:"absolute",top:0,left:0,right:0,bottom:0,cursor:"pointer"}})})]}),e.jsx(w,{direction:"row",alignItems:"center",justifyContent:"center",gap:1})]})}),b!=""&&e.jsxs(w,{direction:"row",spacing:-1,children:[p&&e.jsx(z,{sx:{marginLeft:1,"&:hover":{color:"red",backgroundColor:ce[100]}},onClick:m,children:e.jsx(de,{style:{fontSize:30}})}),d&&e.jsx(z,{color:"primary",onClick:g,children:e.jsx(ue,{style:{fontSize:30}})})]})]}),o&&e.jsx(h,{item:!0,xs:12,sx:{display:"flex",alignItems:"left",justifyContent:"left",pt:2},children:e.jsx(R,{children:o&&e.jsx(Ae,{Error:o})})})]})},Ve=({Id:s,yearId:l,ReportingUserId:n,open:o,handleClose:m,RefreshList:g,saveButton:i})=>{const{showAlert:b,closeAlert:f}=r.useContext(xe),[d,p]=r.useState(""),[I,D]=r.useState("");r.useState("");const[N,y]=r.useState(""),[U,C]=r.useState(!1),v=Number(localStorage.getItem("localSchoolId")),S=localStorage.getItem("FolderName");sessionStorage.getItem("FinancialYearId"),Number(sessionStorage.getItem("AcademicYearId"));const u=Number(localStorage.getItem("UserId")),F=sessionStorage.getItem("Id"),a=x(t=>t.PerformanceGradeAssignment.ISUserInvestmentMethodDetails),j=x(t=>t.PerformanceGradeAssignment.ISGetAllDocumentsList),k=localStorage.getItem("SchoolId"),A=sessionStorage.getItem("FinancialYearId"),_={asSchoolId:Number(k),asFinancialYearId:Number(A),asUserId:Number(s),asDocumentId:null,asDocumentTypeId:8},E={asSchoolId:Number(k),asUserId:Number(s),asFinancialYearId:1,asDocumentTypeId:8,asAcademicYearId:Number(l),asDocumentId:0,asReportingUserId:Number(n),asLoginUserId:Number(sessionStorage.getItem("Id"))},J={asSchoolId:Number(k),asAcademicYearId:Number(l),asFinancialYearId:Number(A),asDocumentId:0,asFileName:d==""?null:d,asUserId:Number(s),asInsertedById:u,asDocumnetTypeId:8,asReportingUserId:Number(n),asSaveFeature:"Performance Evaluation",asFolderName:S.toString(),asBase64String:N==""?null:N};r.useEffect(()=>{c(he(_)),c(B(E)),D("")},[o]),r.useState("");const c=ge(),Q=[{Id:1,Header:"File Name"},{Id:2,Header:"View",align:"center"},{Id:3,Header:"Delete",align:"center"}],O=localStorage.getItem("SiteURL");O.split("/")[O.split("/").length-1];const q=["BMP","DOC","DOCX","JPG","JPEG","PDF","XLS","XLSX"],K=5e6;x(t=>t.AddInvestmentDetailsDoc.ISCheckPublishUnpublishDocument);const P=x(t=>t.AddInvestmentDetailsDoc.ISSaveInvestmentDocument),Y=x(t=>t.AddInvestmentDetailsDoc.ISGetAllDocumentsList);x(t=>t.AddInvestmentDetailsDoc.ISGetInvestmentDocumentFile);const M=x(t=>t.AddInvestmentDetailsDoc.ISDeleteInvestmentDocument),Z={asSchoolId:v,asFinancialYearId:1,asUserId:u},ee={asSchoolId:v,asId:Number(s)};r.useEffect(()=>{c(fe(Z))},[]);const te=()=>{let t=!1;!d||d===""?(D("Please select file to upload."),t=!0):D(""),t||(c(we(J)),$())};r.useEffect(()=>{P!=""&&(H.success(P),c(Ie()),C(!0),c(B(E)),g())},[P]),r.useEffect(()=>{c(De(ee))},[]);const se=t=>{p(t.Name),y(t.Value),D(t.ErrorMsg)},$=()=>{p(""),y("")},ne=t=>{const ae={asSchoolId:v,asFinancialYearId:Number(A),asUpdatedById:u,asDocumentId:Number(t),asDocumnetTypeId:8};b({title:"Please Confirm",message:"Are you sure you want to delete this record?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{f()},onConfirm:()=>{c(Ue(ae)),f()}})};r.useEffect(()=>{M!==""&&(H.success("Document deleted successfully."),c(ye()),C(!0),c(B(E)),g())},[M]);const oe=t=>{window.open(localStorage.getItem("SiteURL")+"/RITESCHOOL/DOWNLOADS/Performance Evaluation/"+t)},L=()=>{$(),m(U)},V=()=>{let t=!0;return n===F&&i==="2"&&(t=!1),t};return e.jsxs(Se,{open:o,maxWidth:"md",fullWidth:!0,onClose:L,PaperProps:{sx:{borderRadius:"15px"}},children:[e.jsxs(je,{sx:{bgcolor:"#223354"},children:[e.jsx(X,{title:"Upload / delete document(s).",children:e.jsx(Pe,{sx:{color:"white",borderRadius:"10px",position:"absolute",top:"4px",right:"35px",cursor:"pointer","&:hover":{backgroundColor:be[600]}}})}),e.jsx(Ce,{onClick:L,sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"8px",cursor:"pointer","&:hover":{color:"red"}}})]}),e.jsxs(ve,{children:[e.jsx(w,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"right",gap:1,sx:{mt:{xs:0,sm:0},flexWrap:{xs:"nowrap",sm:"nowrap"}},children:e.jsxs(T,{children:[e.jsx(R,{variant:"h2",sx:{pt:2,pl:1},children:"Documents"}),e.jsxs(h,{container:!0,spacing:2,mt:.5,children:[e.jsx(h,{item:!0,xs:12,sm:4,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-end"},children:e.jsx(W,{fullWidth:!0,label:e.jsx(e.Fragment,{children:"User Name"}),InputLabelProps:{shrink:!0},sx:{bgcolor:"#F0F0F0",width:"100%"},value:Object.keys(a).length>0?a==null?void 0:a.UserName:"",size:"medium",InputProps:{readOnly:!0}})}),e.jsx(h,{item:!0,xs:12,sm:4,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-end"},children:e.jsx(W,{fullWidth:!0,label:e.jsx(e.Fragment,{children:"Doucment Name"}),InputLabelProps:{shrink:!0},sx:{bgcolor:"#F0F0F0",width:"100%"},value:Object.keys(a).length>0?a==null?void 0:a.DocumentName:"",size:"medium",InputProps:{readOnly:!0}})}),e.jsx(h,{item:!0,xs:12,sm:4,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-end"},children:e.jsx(Ge,{ValidFileTypes:q,MaxfileSize:K,FileName:d,ChangeFile:se,FileLabel:"Upload Document ",width:"100%",height:"52px",FilePath:Y.length>0?Y.FileName:"",errorMessage:I,isMandatory:!0})})]})]})}),e.jsx(T,{sx:{backgroundColor:"white",mt:2,px:1},children:j.length>0?e.jsx(Ee,{HeaderArray:Q,ItemList:j,clickDelete:ne,clickView:oe,isDeletePermission:V()}):e.jsx(R,{variant:"h6",align:"center",color:"blue",sx:{textAlign:"center",marginTop:1,backgroundColor:"#324b84",padding:1,borderRadius:2,color:"white"},children:"No record found."})}),e.jsxs(Fe,{sx:{py:2,px:3},children:[e.jsx(G,{color:"error",onClick:L,children:"Cancel"}),e.jsx(G,{onClick:te,sx:{color:"green","&:hover":{color:"green",backgroundColor:Ne[100]}},disabled:V(),children:"Upload"})]})]})]})};export{$e as D,Ve as U};
