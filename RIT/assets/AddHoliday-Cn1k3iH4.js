import{q as be,v as ve,A as pe,u as ke,r as a,az as y,c as n,aA as Te,aB as Ne,aC as O,aD as we,aE as Re,t as q,aF as Be,j as t,B as $,C as Pe,E as Q,I as X,H as _e,J as H,K as Le,G as d,aG as Z,aH as i,o as j,T as Ye,n as Fe,a6 as ee,ap as Ve,aI as te,aJ as E,aK as Me,aL as ze}from"./index-CpZD2H93.js";import{S as Ge}from"./SelectListHierarchy-B0--0w-H.js";const Ke=({})=>{let{Holiday_Id:r}=be();r=ve(r);const I=pe(),c=ke(),[C,A]=a.useState([]),h=Number(localStorage.getItem("localSchoolId")),S=Number(sessionStorage.getItem("AcademicYearId")),[o,b]=a.useState(y(new Date)),[ae,v]=a.useState(""),[l,p]=a.useState(y(new Date)),[se,D]=a.useState(""),[m,k]=a.useState(""),[re,T]=a.useState(""),[oe,N]=a.useState(""),[le,w]=a.useState(""),[ie,R]=a.useState(""),[de,B]=a.useState(1),[f,P]=a.useState(""),[_,L]=a.useState(""),[ne,Y]=a.useState(""),[ce,F]=a.useState(""),[ue,V]=a.useState(""),[me,M]=a.useState(""),he=Number(localStorage.getItem("UserId"));a.useState();const[Ue,Se]=a.useState(""),z=n(e=>e.Holidays.AllClassesAndDivisionss),De=n(e=>e.Holidays.AllClassesAndDivisionss1),G=n(e=>e.Holidays.SaveHoliday),ye=n(e=>e.Holidays.IHolidayDuplicateNameValidationCount),u=n(e=>e.Holidays.EditHolidayDetails),Ee=n(e=>e.Holidays.IHolidayStartAndEndDatePredefinedValidationCount);n(e=>e.Holidays.Loading);const U=ye.filter(e=>e.DuplicateHolidayNameCount),fe=U.length>0?U[0]:null,W=Ee.filter(e=>e.PredefinedStartDateAndEndDateCount),xe=W.length>0?W[0]:null;a.useEffect(()=>{const e=new Date(o),Ae=new Date(l).getTime()-e.getTime();let g=Math.ceil(Ae/(1e3*60*60*24)+1);g<0&&(g=0),B(g)},[o,l]);const J=()=>{let e=[];return C.map(s=>{s.IsActive&&e.push(s.Id)}),e.toString()},x=J();a.useEffect(()=>{if(r!=null){const e={asHoliday_Id:Number(r),asSchoolId:Number(h),asAcademicYearID:Number(S)};c(Te(e))}else c(Ne())},[]),a.useEffect(()=>{if(r!=null&&u.length>0&&u[0]!=null){const s=u[0];b(O(s.Holiday_Start_Date)),p(O(s.Holiday_End_Date)),k(s.Holiday_Name),P(s.Remarks),Se(s.AssociatedStandard)}const e={asSchoolId:h,asAcademicYearId:S,associatedStandard:r==null||u.length==0?[]:u[0].AssociatedStandard};c(we(e))},[u]);const ge={asHolidayName:m,asRemarks:f,asStartDate:o,asEndDate:l,asSchoolId:h,asAcademicYearID:S,asInsertedById:he,asAssociatedStandard:x,asHoliday_Id:Number(r||0)};a.useEffect(()=>{const e={asSchoolId:h,asAcademicYearId:S,asStandardDivIds:x,asHolidayId:Number(r||0),asHolidayName:m,asHolidayStartDate:o,asHolidayEndDate:l};c(Re(e))},[x,o,l,m]),a.useEffect(()=>{A(z)},[z]);const He=e=>{A(e)},je=e=>{b(y(e))},Ie=e=>{p(y(e))},K=()=>{let e=!1,s=!1;m==""?(T("Holiday name should not be blank."),e=!0):T(""),J()?Y(""):(Y("At least one class should be associated."),e=!0),o===""?(M("Please choose a valid start date."),s=!0,e=!0):M(""),o===null?(w("Start Date should not be blank."),s=!0,e=!0):w(""),l==""?(D("Please choose a valid End date."),s=!0,e=!0):D(""),l==null?(R("End Date should not be blank."),s=!0,e=!0):R(""),s==!1&&(te(o)?(v("Holiday start date must be within current academic year (i.e between "+E(sessionStorage.getItem("StartDate"))+" and "+E(sessionStorage.getItem("EndDate"))+")."),s=!0,e=!0):v(""),te(l)?(D("Holiday end date must be within current academic year (i.e between "+E(sessionStorage.getItem("StartDate"))+" and "+E(sessionStorage.getItem("EndDate"))+")."),s=!0,e=!0):D("")),Me(l,o)?(F("End date should not be less than start date."),s=!0,e=!0):F(""),xe.PredefinedStartDateAndEndDateCount!=="0"&&s==!1?(V("Holiday already defined."),e=!0):V(""),f.length>200?(L("Remark should be less than 200 characters."),e=!0):L(""),fe.DuplicateHolidayNameCount!=="0"?(N("Holiday name already exists."),e=!0):N(""),e||c(ze(ge))};a.useEffect(()=>{G!=""&&(r?q.success("Holiday details updated successfully.",{toastId:"success1"}):q.success("Holiday details saved successfully.",{toastId:"success1"}),c(Be()),I("/RITeSchool/Admin/SchoolConfiguration/Holidays",{state:{fromInternal:!0}}))},[G]),a.useEffect(()=>{(o===null||l===null)&&B(0)},[o,l]);const Ce=()=>{I("/RITeSchool/Admin/SchoolConfiguration/Holidays",{state:{fromInternal:!0}})};return t.jsx(t.Fragment,{children:t.jsxs($,{sx:{px:2},children:[t.jsx(Pe,{navLinks:[{title:"Holidays",path:"/RITeSchool/Admin/SchoolConfiguration/Holidays"},r?{title:"Edit Holiday",path:"/RITeSchool/Admin/SchoolConfiguration/EditHoliday/"}:{title:"Add Holiday",path:"/RITeSchool/Admin/SchoolConfiguration/AddHoliday"}],rightActions:t.jsxs(t.Fragment,{children:[t.jsx(Q,{title:"Declare a new classwise holiday for your school.",children:t.jsx(X,{sx:{bgcolor:"grey.500",color:"white","&:hover":{bgcolor:"grey.600"}},children:t.jsx(_e,{})})}),t.jsx(Q,{title:"Save",children:t.jsx(X,{onClick:K,sx:{background:H[500],color:"white","&:hover":{backgroundColor:H[600]}},children:t.jsx(Le,{})})})]})}),t.jsx($,{sx:{p:2,background:"white"},children:t.jsxs(d,{container:!0,spacing:2,children:[t.jsxs(d,{item:!0,xs:12,md:4,children:[t.jsx(Z,{DateValue:o,onDateChange:je,label:"Start Date",size:"medium"}),t.jsx(i,{Error:ae}),t.jsx(i,{Error:me}),t.jsx(i,{Error:le})]}),t.jsxs(d,{item:!0,xs:12,md:4,children:[t.jsx(Z,{DateValue:l,onDateChange:Ie,label:"End Date",size:"medium"}),t.jsx(i,{Error:se}),t.jsx(i,{Error:ce}),t.jsx(i,{Error:ue}),t.jsx(i,{Error:ie})]}),t.jsx(d,{item:!0,xs:12,md:4,children:t.jsx(j,{label:"Total Days",value:de,InputProps:{readOnly:!0},fullWidth:!0})}),t.jsxs(d,{xs:12,md:6,item:!0,children:[t.jsx(j,{label:t.jsxs("span",{children:["Name ",t.jsx("span",{style:{color:"red"},children:"*"})]}),multiline:!0,rows:1,value:m,onChange:e=>{const s=e.target.value;s.length<=50&&k(s)},fullWidth:!0,sx:{resize:"both"}}),t.jsx(i,{Error:re}),t.jsx(i,{Error:oe})]}),t.jsx(d,{xs:12,md:6,item:!0,children:t.jsx(j,{label:t.jsx("span",{children:"Remark"}),multiline:!0,rows:1,value:f,onChange:e=>{P(e.target.value)},fullWidth:!0,error:_!=="",helperText:_})}),t.jsxs(d,{item:!0,xs:12,md:12,children:[t.jsxs(Ye,{variant:"h6",children:["Associated Classes ",t.jsx("span",{style:{color:"red"},children:"*"})]}),t.jsx(Ge,{ItemList:C,ParentList:De,ClickChild:He}),t.jsx(i,{Error:ne})]}),t.jsx(d,{item:!0,xs:12,md:12,children:t.jsxs(Fe,{direction:"row",gap:2,alignItems:"center",children:[t.jsx(ee,{sx:{color:"red",":hover":{backgroundColor:Ve[100]}},onClick:Ce,children:"Cancel"}),t.jsx(ee,{sx:{color:"green",":hover":{backgroundColor:H[100]}},onClick:K,children:"Save"})]})})]})})]})})};export{Ke as default};
